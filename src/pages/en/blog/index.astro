---
import Layout from '../../../layouts/Layout.astro';
import { getAllPosts, calculateReadingTime } from '../../../utils/blog';

const lang = 'en';
const posts = await getAllPosts(lang);

const pageTitle = 'Blog | JudySylph';
const pageDescription = 'Practical guides on finance, taxes, and real estate calculations.';
---

<Layout title={pageTitle} description={pageDescription}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-12">
      <div class="text-5xl mb-4">üìù</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Blog</h1>
      <p class="text-gray-600 dark:text-gray-400">Practical guides on finance, taxes, and more</p>
    </div>

    <!-- Blog Posts -->
    {posts.length > 0 ? (
      <div class="space-y-6">
        {posts.map(async (post) => {
          const readingTime = calculateReadingTime(post.body);
          const slug = post.slug.replace(/^en\//, '');

          return (
            <a
              href={`/en/blog/${slug}`}
              class="block bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all border border-gray-100 dark:border-gray-700 hover:border-primary-300 dark:hover:border-primary-600"
            >
              <div class="flex items-start gap-4">
                <div class="text-4xl">{post.data.emoji}</div>
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <span class="text-xs px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 rounded-full">
                      {post.data.category}
                    </span>
                    <span class="text-xs text-gray-500">{readingTime} min read</span>
                  </div>
                  <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-2 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                    {post.data.title}
                  </h2>
                  <p class="text-gray-600 dark:text-gray-400 line-clamp-2">
                    {post.data.description}
                  </p>
                  <div class="mt-3 flex items-center gap-4">
                    <time class="text-sm text-gray-500">
                      {post.data.publishDate.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                      })}
                    </time>
                    {post.data.keywords.slice(0, 3).map((keyword) => (
                      <span class="text-xs text-gray-400">#{keyword}</span>
                    ))}
                  </div>
                </div>
              </div>
            </a>
          );
        })}
      </div>
    ) : (
      <div class="text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-2xl">
        <div class="text-5xl mb-4">üì≠</div>
        <p class="text-gray-600 dark:text-gray-400">No posts yet.</p>
      </div>
    )}

    <!-- Back Link -->
    <div class="mt-12 text-center">
      <a href="/en" class="text-primary-600 dark:text-primary-400 hover:underline">
        ‚Üê Back to Home
      </a>
    </div>
  </div>
</Layout>
