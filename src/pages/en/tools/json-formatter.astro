---
import Layout from '../../../layouts/Layout.astro';
import { getTool } from '../../../utils/tools';

const lang = 'en';
const tool = getTool('json-formatter', lang);

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": tool?.title,
  "description": tool?.description,
  "applicationCategory": "UtilityApplication",
  "operatingSystem": "All",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "provider": {
    "@type": "Organization",
    "name": "JudySylph",
    "url": "https://judysylph.com"
  }
};
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description} jsonLd={jsonLd}>
  <div class="max-w-6xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
    </div>

    <!-- Tool Area -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Input -->
        <div>
          <div class="flex justify-between items-center mb-2">
            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Input</label>
            <button id="paste-btn" class="text-sm text-primary-600 dark:text-primary-400 hover:underline">Paste</button>
          </div>
          <textarea
            id="json-input"
            rows="20"
            placeholder='{"key": "value"}'
            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none"
          ></textarea>
        </div>

        <!-- Output -->
        <div>
          <div class="flex justify-between items-center mb-2">
            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Output</label>
            <button id="copy-btn" class="text-sm text-primary-600 dark:text-primary-400 hover:underline">Copy</button>
          </div>
          <textarea
            id="json-output"
            rows="20"
            readonly
            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white font-mono text-sm resize-none"
          ></textarea>
        </div>
      </div>

      <!-- Buttons -->
      <div class="flex flex-wrap gap-3 mt-6">
        <button
          id="format-btn"
          class="px-6 py-3 bg-primary-600 text-white rounded-xl font-medium hover:bg-primary-700 transition-colors"
        >
          Format
        </button>
        <button
          id="minify-btn"
          class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-xl font-medium hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
        >
          Minify
        </button>
        <button
          id="clear-btn"
          class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-xl font-medium hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
        >
          Clear
        </button>
      </div>

      <!-- Status -->
      <div id="status" class="mt-4 hidden">
        <div id="status-message" class="px-4 py-2 rounded-lg text-sm"></div>
      </div>
    </div>

    <!-- Info Section -->
    <div class="mt-8 space-y-4">
      <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-5">
        <h2 class="font-bold text-blue-800 dark:text-blue-200 mb-3">What is JSON?</h2>
        <ul class="text-sm text-blue-700 dark:text-blue-300 space-y-2">
          <li><strong>JSON (JavaScript Object Notation)</strong>: A lightweight data interchange format.</li>
          <li>Easy for humans to read and write, easy for machines to parse and generate.</li>
          <li>Widely used for APIs, configuration files, and data storage.</li>
          <li>More concise than XML, making it the web development standard.</li>
        </ul>
      </div>

      <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-5">
        <h2 class="font-bold text-green-800 dark:text-green-200 mb-3">JSON Syntax Basics</h2>
        <div class="text-sm text-green-700 dark:text-green-300 space-y-2">
          <p>• <strong>Objects</strong>: Curly braces with key-value pairs, e.g. object notation</p>
          <p>• <strong>Arrays</strong>: Square brackets, comma-separated values</p>
          <p>• <strong>Strings</strong>: Must use double quotes (single quotes not allowed)</p>
          <p>• <strong>Numbers</strong>: Written without quotes (integers and decimals)</p>
          <p>• <strong>Booleans</strong>: true or false (lowercase only)</p>
          <p>• <strong>null</strong>: Represents empty value (lowercase)</p>
        </div>
      </div>

      <div class="bg-red-50 dark:bg-red-900/20 rounded-xl p-5">
        <h2 class="font-bold text-red-800 dark:text-red-200 mb-3">Common JSON Errors</h2>
        <ul class="text-sm text-red-700 dark:text-red-300 space-y-1">
          <li>• <strong>Trailing comma</strong>: Comma after the last item causes errors</li>
          <li>• <strong>Single quotes</strong>: Strings must use double quotes only</li>
          <li>• <strong>Comments</strong>: JSON doesn't support comments</li>
          <li>• <strong>Unquoted keys</strong>: All keys must be strings (quoted)</li>
          <li>• <strong>undefined</strong>: null is valid, but undefined is not</li>
        </ul>
      </div>

      <div class="bg-purple-50 dark:bg-purple-900/20 rounded-xl p-5">
        <h2 class="font-bold text-purple-800 dark:text-purple-200 mb-3">JSON Use Cases</h2>
        <ul class="text-sm text-purple-700 dark:text-purple-300 space-y-1">
          <li>• <strong>REST APIs</strong>: Server-client data communication</li>
          <li>• <strong>Config Files</strong>: package.json, tsconfig.json, etc.</li>
          <li>• <strong>NoSQL Databases</strong>: MongoDB, Firebase data storage</li>
          <li>• <strong>Local Storage</strong>: Browser data persistence</li>
        </ul>
      </div>
    </div>

    <!-- Back Link -->
    <div class="mt-8 text-center">
      <a href="/en/tools" class="text-primary-600 dark:text-primary-400 hover:underline">
        ← Back to Tools
      </a>
    </div>
  </div>
</Layout>

<script>
  const jsonInput = document.getElementById('json-input') as HTMLTextAreaElement;
  const jsonOutput = document.getElementById('json-output') as HTMLTextAreaElement;
  const formatBtn = document.getElementById('format-btn');
  const minifyBtn = document.getElementById('minify-btn');
  const clearBtn = document.getElementById('clear-btn');
  const copyBtn = document.getElementById('copy-btn');
  const pasteBtn = document.getElementById('paste-btn');
  const status = document.getElementById('status');
  const statusMessage = document.getElementById('status-message');

  function showStatus(message: string, isError: boolean) {
    if (status && statusMessage) {
      status.classList.remove('hidden');
      statusMessage.textContent = message;
      statusMessage.className = `px-4 py-2 rounded-lg text-sm ${isError ? 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400' : 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'}`;
    }
  }

  function format() {
    try {
      const input = jsonInput.value.trim();
      if (!input) {
        showStatus('Please enter JSON', true);
        return;
      }
      const parsed = JSON.parse(input);
      jsonOutput.value = JSON.stringify(parsed, null, 2);
      showStatus('Formatted successfully!', false);
    } catch (e) {
      showStatus('Invalid JSON: ' + (e as Error).message, true);
    }
  }

  function minify() {
    try {
      const input = jsonInput.value.trim();
      if (!input) {
        showStatus('Please enter JSON', true);
        return;
      }
      const parsed = JSON.parse(input);
      jsonOutput.value = JSON.stringify(parsed);
      showStatus('Minified successfully!', false);
    } catch (e) {
      showStatus('Invalid JSON: ' + (e as Error).message, true);
    }
  }

  formatBtn?.addEventListener('click', format);
  minifyBtn?.addEventListener('click', minify);

  clearBtn?.addEventListener('click', () => {
    jsonInput.value = '';
    jsonOutput.value = '';
    status?.classList.add('hidden');
  });

  copyBtn?.addEventListener('click', async () => {
    const text = jsonOutput.value;
    if (!text) {
      showStatus('Nothing to copy', true);
      return;
    }
    try {
      await navigator.clipboard.writeText(text);
      showStatus('Copied to clipboard!', false);
    } catch {
      showStatus('Failed to copy', true);
    }
  });

  pasteBtn?.addEventListener('click', async () => {
    try {
      const text = await navigator.clipboard.readText();
      jsonInput.value = text;
      format();
    } catch {
      showStatus('Failed to paste', true);
    }
  });

  // Auto-format on input
  jsonInput?.addEventListener('input', () => {
    status?.classList.add('hidden');
  });
</script>
