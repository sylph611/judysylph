---
import Layout from '../../../layouts/Layout.astro';
import { getTool, generateToolBreadcrumbSchema, generateToolHowToSchema, calculatorSteps, getToolStepType } from '../../../utils/tools';

const lang = 'en';
const tool = getTool('color-converter', lang);

const siteUrl = 'https://judysylph.com';
const stepType = getToolStepType('color-converter');
const steps = calculatorSteps['en'][stepType];

const webAppSchema = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": tool?.title,
  "description": tool?.description,
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "All",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" }
};

const breadcrumbSchema = tool ? generateToolBreadcrumbSchema(tool, 'en', siteUrl) : null;
const howToSchema = tool ? generateToolHowToSchema(tool, 'en', siteUrl, steps) : null;

const jsonLd = [webAppSchema, breadcrumbSchema, howToSchema].filter(Boolean);
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description} jsonLd={jsonLd}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
    </div>

    <!-- Tool Area -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <!-- Color Preview -->
      <div class="mb-6">
        <div
          id="color-preview"
          class="w-full h-32 rounded-xl border-4 border-gray-200 dark:border-gray-600 transition-colors"
          style="background-color: #6366f1"
        ></div>
      </div>

      <!-- Color Picker -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Pick a Color
        </label>
        <input
          type="color"
          id="color-picker"
          value="#6366f1"
          class="w-full h-12 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 cursor-pointer"
        />
      </div>

      <!-- Color Values -->
      <div class="space-y-4">
        <!-- HEX -->
        <div>
          <label for="hex-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            HEX
          </label>
          <div class="flex gap-2">
            <input
              type="text"
              id="hex-input"
              value="#6366f1"
              class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono"
              placeholder="#000000"
            />
            <button type="button" class="copy-btn px-4 py-3 bg-gray-200 dark:bg-gray-600 rounded-xl hover:bg-gray-300 dark:hover:bg-gray-500" data-target="hex-input">
              üìã
            </button>
          </div>
        </div>

        <!-- RGB -->
        <div>
          <label for="rgb-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            RGB
          </label>
          <div class="flex gap-2">
            <input
              type="text"
              id="rgb-input"
              value="rgb(99, 102, 241)"
              class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono"
              placeholder="rgb(0, 0, 0)"
            />
            <button type="button" class="copy-btn px-4 py-3 bg-gray-200 dark:bg-gray-600 rounded-xl hover:bg-gray-300 dark:hover:bg-gray-500" data-target="rgb-input">
              üìã
            </button>
          </div>
        </div>

        <!-- HSL -->
        <div>
          <label for="hsl-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            HSL
          </label>
          <div class="flex gap-2">
            <input
              type="text"
              id="hsl-input"
              value="hsl(239, 84%, 67%)"
              class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono"
              placeholder="hsl(0, 0%, 0%)"
            />
            <button type="button" class="copy-btn px-4 py-3 bg-gray-200 dark:bg-gray-600 rounded-xl hover:bg-gray-300 dark:hover:bg-gray-500" data-target="hsl-input">
              üìã
            </button>
          </div>
        </div>

        <!-- RGB Values -->
        <div class="grid grid-cols-3 gap-4">
          <div class="bg-red-50 dark:bg-red-900/20 p-3 rounded-xl text-center">
            <div class="text-red-600 dark:text-red-400 text-sm">R</div>
            <div id="r-value" class="text-xl font-bold text-red-700 dark:text-red-300">99</div>
          </div>
          <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-xl text-center">
            <div class="text-green-600 dark:text-green-400 text-sm">G</div>
            <div id="g-value" class="text-xl font-bold text-green-700 dark:text-green-300">102</div>
          </div>
          <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-xl text-center">
            <div class="text-blue-600 dark:text-blue-400 text-sm">B</div>
            <div id="b-value" class="text-xl font-bold text-blue-700 dark:text-blue-300">241</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Info Section -->
    <div class="mt-8 space-y-4">
      <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-5">
        <h2 class="font-bold text-blue-800 dark:text-blue-200 mb-3">Understanding Color Formats</h2>
        <ul class="text-sm text-blue-700 dark:text-blue-300 space-y-2">
          <li><strong>HEX (#RRGGBB)</strong>: Hexadecimal notation, most common in web development.</li>
          <li><strong>RGB (R, G, B)</strong>: Red, Green, Blue light mixing with values 0-255.</li>
          <li><strong>HSL (H, S%, L%)</strong>: Hue (color), Saturation (intensity), Lightness (brightness).</li>
          <li><strong>RGBA/HSLA</strong>: Same formats with added Alpha (transparency) channel.</li>
        </ul>
      </div>

      <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-5">
        <h2 class="font-bold text-green-800 dark:text-green-200 mb-3">Primary Web Colors</h2>
        <div class="grid grid-cols-3 md:grid-cols-6 gap-2 text-xs text-center">
          <div><div class="h-8 rounded" style="background:#FF0000"></div><p class="mt-1 text-green-700 dark:text-green-300">Red</p></div>
          <div><div class="h-8 rounded" style="background:#00FF00"></div><p class="mt-1 text-green-700 dark:text-green-300">Green</p></div>
          <div><div class="h-8 rounded" style="background:#0000FF"></div><p class="mt-1 text-green-700 dark:text-green-300">Blue</p></div>
          <div><div class="h-8 rounded" style="background:#FFFF00"></div><p class="mt-1 text-green-700 dark:text-green-300">Yellow</p></div>
          <div><div class="h-8 rounded" style="background:#FF00FF"></div><p class="mt-1 text-green-700 dark:text-green-300">Magenta</p></div>
          <div><div class="h-8 rounded" style="background:#00FFFF"></div><p class="mt-1 text-green-700 dark:text-green-300">Cyan</p></div>
        </div>
      </div>

      <div class="bg-purple-50 dark:bg-purple-900/20 rounded-xl p-5">
        <h2 class="font-bold text-purple-800 dark:text-purple-200 mb-3">Color Code Use Cases</h2>
        <ul class="text-sm text-purple-700 dark:text-purple-300 space-y-1">
          <li>‚Ä¢ <strong>Web Development</strong>: CSS styling, theme customization</li>
          <li>‚Ä¢ <strong>Graphic Design</strong>: Photoshop, Illustrator workflows</li>
          <li>‚Ä¢ <strong>Branding</strong>: Corporate identity color guidelines</li>
          <li>‚Ä¢ <strong>UI/UX Design</strong>: App and website design systems</li>
          <li>‚Ä¢ <strong>Print</strong>: Converting to CMYK for printing</li>
        </ul>
      </div>
    </div>

    <!-- Back Link -->
    <div class="mt-8 text-center">
      <a href="/en/tools" class="text-primary-600 dark:text-primary-400 hover:underline">
        ‚Üê Back to Tools
      </a>
    </div>
  </div>
</Layout>

<script>
  const colorPicker = document.getElementById('color-picker') as HTMLInputElement;
  const colorPreview = document.getElementById('color-preview');
  const hexInput = document.getElementById('hex-input') as HTMLInputElement;
  const rgbInput = document.getElementById('rgb-input') as HTMLInputElement;
  const hslInput = document.getElementById('hsl-input') as HTMLInputElement;
  const rValue = document.getElementById('r-value');
  const gValue = document.getElementById('g-value');
  const bValue = document.getElementById('b-value');

  function hexToRgb(hex: string): { r: number; g: number; b: number } | null {
    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
      r: parseInt(result[1], 16),
      g: parseInt(result[2], 16),
      b: parseInt(result[3], 16)
    } : null;
  }

  function rgbToHex(r: number, g: number, b: number): string {
    return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
  }

  function rgbToHsl(r: number, g: number, b: number): { h: number; s: number; l: number } {
    r /= 255; g /= 255; b /= 255;
    const max = Math.max(r, g, b), min = Math.min(r, g, b);
    let h = 0, s = 0;
    const l = (max + min) / 2;

    if (max !== min) {
      const d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      switch (max) {
        case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
        case g: h = ((b - r) / d + 2) / 6; break;
        case b: h = ((r - g) / d + 4) / 6; break;
      }
    }

    return { h: Math.round(h * 360), s: Math.round(s * 100), l: Math.round(l * 100) };
  }

  function hslToRgb(h: number, s: number, l: number): { r: number; g: number; b: number } {
    h /= 360; s /= 100; l /= 100;
    let r, g, b;

    if (s === 0) {
      r = g = b = l;
    } else {
      const hue2rgb = (p: number, q: number, t: number) => {
        if (t < 0) t += 1;
        if (t > 1) t -= 1;
        if (t < 1/6) return p + (q - p) * 6 * t;
        if (t < 1/2) return q;
        if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
        return p;
      };
      const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
      const p = 2 * l - q;
      r = hue2rgb(p, q, h + 1/3);
      g = hue2rgb(p, q, h);
      b = hue2rgb(p, q, h - 1/3);
    }

    return { r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255) };
  }

  function updateFromHex(hex: string) {
    const rgb = hexToRgb(hex);
    if (!rgb) return;

    const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);

    if (colorPreview) colorPreview.style.backgroundColor = hex;
    if (colorPicker) colorPicker.value = hex;
    if (hexInput) hexInput.value = hex;
    if (rgbInput) rgbInput.value = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
    if (hslInput) hslInput.value = `hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%)`;
    if (rValue) rValue.textContent = String(rgb.r);
    if (gValue) gValue.textContent = String(rgb.g);
    if (bValue) bValue.textContent = String(rgb.b);
  }

  colorPicker?.addEventListener('input', (e) => {
    updateFromHex((e.target as HTMLInputElement).value);
  });

  hexInput?.addEventListener('input', (e) => {
    const value = (e.target as HTMLInputElement).value;
    if (/^#[0-9A-Fa-f]{6}$/.test(value)) {
      updateFromHex(value);
    }
  });

  rgbInput?.addEventListener('input', (e) => {
    const value = (e.target as HTMLInputElement).value;
    const match = value.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
    if (match) {
      const hex = rgbToHex(parseInt(match[1]), parseInt(match[2]), parseInt(match[3]));
      updateFromHex(hex);
    }
  });

  hslInput?.addEventListener('input', (e) => {
    const value = (e.target as HTMLInputElement).value;
    const match = value.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);
    if (match) {
      const rgb = hslToRgb(parseInt(match[1]), parseInt(match[2]), parseInt(match[3]));
      const hex = rgbToHex(rgb.r, rgb.g, rgb.b);
      updateFromHex(hex);
    }
  });

  document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const targetId = (btn as HTMLElement).dataset.target;
      const input = document.getElementById(targetId!) as HTMLInputElement;
      try {
        await navigator.clipboard.writeText(input?.value || '');
        alert('Copied!');
      } catch {
        alert('Failed to copy');
      }
    });
  });
</script>
