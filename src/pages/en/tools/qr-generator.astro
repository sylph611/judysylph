---
import Layout from '../../../layouts/Layout.astro';
import { getTool } from '../../../utils/tools';

const lang = 'en';
const tool = getTool('qr-generator', lang);

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": tool?.title,
  "description": tool?.description,
  "applicationCategory": "UtilityApplication",
  "operatingSystem": "All",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "provider": {
    "@type": "Organization",
    "name": "JudySylph",
    "url": "https://judysylph.com"
  }
};
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description} jsonLd={jsonLd}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
    </div>

    <!-- Tool Area -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <!-- Input -->
      <div class="mb-6">
        <label for="qr-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Enter Text or URL
        </label>
        <textarea
          id="qr-input"
          rows="3"
          placeholder="Enter text or URL to convert to QR code..."
          class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-y"
        ></textarea>
      </div>

      <!-- Options -->
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div>
          <label for="qr-size" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Size
          </label>
          <select
            id="qr-size"
            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500"
          >
            <option value="128">128 x 128</option>
            <option value="256" selected>256 x 256</option>
            <option value="512">512 x 512</option>
          </select>
        </div>
        <div>
          <label for="qr-color" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Color
          </label>
          <input
            type="color"
            id="qr-color"
            value="#000000"
            class="w-full h-12 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 cursor-pointer"
          />
        </div>
      </div>

      <!-- Generate Button -->
      <button
        id="generate-btn"
        type="button"
        class="w-full px-6 py-3 bg-primary-600 text-white font-medium rounded-xl hover:bg-primary-700 transition-colors mb-6"
      >
        Generate QR Code
      </button>

      <!-- QR Code Result -->
      <div id="qr-result" class="hidden">
        <div class="flex flex-col items-center gap-4 p-6 bg-gray-50 dark:bg-gray-700 rounded-xl">
          <canvas id="qr-canvas" class="bg-white p-4 rounded-lg"></canvas>
          <button
            id="download-btn"
            type="button"
            class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
          >
            Download Image
          </button>
        </div>
      </div>
    </div>

    <!-- Info Section -->
    <div class="mt-8 space-y-4">
      <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-5">
        <h2 class="font-bold text-blue-800 dark:text-blue-200 mb-3">What is a QR Code?</h2>
        <ul class="text-sm text-blue-700 dark:text-blue-300 space-y-2">
          <li>• <strong>QR (Quick Response)</strong>: A 2D barcode designed for fast scanning.</li>
          <li>• Invented in 1994 by Denso Wave in Japan, now used worldwide.</li>
          <li>• Can store up to 7,089 numeric or 4,296 alphanumeric characters.</li>
          <li>• Features error correction that allows recovery even if 30% damaged.</li>
        </ul>
      </div>

      <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-5">
        <h2 class="font-bold text-green-800 dark:text-green-200 mb-3">QR Code Applications</h2>
        <div class="grid grid-cols-2 gap-4 text-sm text-green-700 dark:text-green-300">
          <div>
            <p>• <strong>URLs</strong>: Share website links</p>
            <p>• <strong>Payments</strong>: Mobile payment systems</p>
            <p>• <strong>Business Cards</strong>: Contact info sharing</p>
            <p>• <strong>WiFi</strong>: Easy network connection</p>
          </div>
          <div>
            <p>• <strong>Authentication</strong>: Building/event access</p>
            <p>• <strong>Product Info</strong>: Detailed specifications</p>
            <p>• <strong>Menus</strong>: Contactless restaurant ordering</p>
            <p>• <strong>Marketing</strong>: Promotions and coupons</p>
          </div>
        </div>
      </div>

      <div class="bg-purple-50 dark:bg-purple-900/20 rounded-xl p-5">
        <h2 class="font-bold text-purple-800 dark:text-purple-200 mb-3">Tips for Better QR Codes</h2>
        <ul class="text-sm text-purple-700 dark:text-purple-300 space-y-1">
          <li>• <strong>Use URL shorteners</strong>: Shorter data creates simpler QR codes.</li>
          <li>• <strong>Adequate size</strong>: Print at least 2x2 cm for reliable scanning.</li>
          <li>• <strong>High contrast</strong>: Dark code on light background works best.</li>
          <li>• <strong>Quiet zone</strong>: Leave white space around the QR code.</li>
          <li>• <strong>Test first</strong>: Scan with multiple devices before printing.</li>
        </ul>
      </div>
    </div>

    <!-- Back Link -->
    <div class="mt-8 text-center">
      <a href="/en/tools" class="text-primary-600 dark:text-primary-400 hover:underline">
        ← Back to Tools
      </a>
    </div>
  </div>
</Layout>

<script is:inline src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script is:inline>
  function setupQRGenerator() {
    const qrInput = document.getElementById('qr-input');
    const qrSize = document.getElementById('qr-size');
    const qrColor = document.getElementById('qr-color');
    const generateBtn = document.getElementById('generate-btn');
    const qrResult = document.getElementById('qr-result');
    const qrCanvas = document.getElementById('qr-canvas');
    const downloadBtn = document.getElementById('download-btn');

    if (!generateBtn || generateBtn.dataset.initialized) return;
    generateBtn.dataset.initialized = 'true';

    generateBtn.addEventListener('click', function() {
      const text = qrInput?.value.trim();
      if (!text) {
        alert('Please enter some text');
        return;
      }

      const size = parseInt(qrSize?.value || '256');
      const color = qrColor?.value || '#000000';

      if (typeof QRCode !== 'undefined') {
        QRCode.toCanvas(qrCanvas, text, {
          width: size,
          margin: 2,
          color: {
            dark: color,
            light: '#ffffff'
          }
        }, function(error) {
          if (error) {
            console.error(error);
            alert('Failed to generate QR code');
            return;
          }
          qrResult?.classList.remove('hidden');
        });
      } else {
        alert('Loading QR library. Please try again in a moment.');
      }
    });

    downloadBtn?.addEventListener('click', function() {
      const link = document.createElement('a');
      link.download = 'qrcode.png';
      link.href = qrCanvas?.toDataURL('image/png') || '';
      link.click();
    });
  }

  // Run on initial load and after View Transitions
  setupQRGenerator();
  document.addEventListener('astro:page-load', setupQRGenerator);
</script>
