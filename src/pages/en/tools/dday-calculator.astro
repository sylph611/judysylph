---
import Layout from '../../../layouts/Layout.astro';
import { getTool, generateToolBreadcrumbSchema, generateToolHowToSchema, calculatorSteps, getToolStepType } from '../../../utils/tools';

const lang = 'en';
const tool = getTool('dday-calculator', lang);

const siteUrl = 'https://judysylph.com';
const stepType = getToolStepType('dday-calculator');
const steps = calculatorSteps['en'][stepType];

const webAppSchema = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": tool?.title,
  "description": tool?.description,
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "All",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" }
};

const breadcrumbSchema = tool ? generateToolBreadcrumbSchema(tool, 'en', siteUrl) : null;
const howToSchema = tool ? generateToolHowToSchema(tool, 'en', siteUrl, steps) : null;

const jsonLd = [webAppSchema, breadcrumbSchema, howToSchema].filter(Boolean);
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description} jsonLd={jsonLd}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
    </div>

    <!-- Tool Area -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <div class="space-y-6">
        <div>
          <label for="target-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Select Target Date
          </label>
          <input
            type="date"
            id="target-date"
            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
          />
        </div>

        <div>
          <label for="event-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Event Name (Optional)
          </label>
          <input
            type="text"
            id="event-name"
            placeholder="e.g., Vacation, Exam, Anniversary"
            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
          />
        </div>

        <button
          id="calculate-btn"
          type="button"
          class="w-full px-6 py-3 bg-primary-600 text-white rounded-xl font-medium hover:bg-primary-700 transition-colors"
        >
          Calculate
        </button>
      </div>

      <!-- Result -->
      <div id="result-area" class="mt-8 hidden">
        <div class="text-center p-8 bg-gradient-to-br from-primary-500 to-secondary-500 rounded-2xl text-white">
          <div id="event-display" class="text-lg mb-2 opacity-90"></div>
          <div id="dday-result" class="text-6xl font-bold mb-4"></div>
          <div id="date-display" class="opacity-90"></div>
        </div>

        <div class="mt-6 grid grid-cols-3 gap-4 text-center">
          <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4">
            <div id="weeks" class="text-2xl font-bold text-primary-600 dark:text-primary-400">0</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Weeks</div>
          </div>
          <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4">
            <div id="hours" class="text-2xl font-bold text-primary-600 dark:text-primary-400">0</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Hours</div>
          </div>
          <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4">
            <div id="minutes" class="text-2xl font-bold text-primary-600 dark:text-primary-400">0</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Minutes</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Info Section -->
    <div class="mt-8 space-y-4">
      <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-5">
        <h2 class="font-bold text-blue-800 dark:text-blue-200 mb-3">Understanding D-Day Notation</h2>
        <ul class="text-sm text-blue-700 dark:text-blue-300 space-y-2">
          <li>• <strong>D-Day</strong>: The target date itself (Day zero)</li>
          <li>• <strong>D-Number</strong>: Days remaining until the target (e.g., D-30 = 30 days left)</li>
          <li>• <strong>D+Number</strong>: Days since the target date (e.g., D+100 = 100 days ago)</li>
          <li>• The term originates from the WWII Normandy invasion planning.</li>
        </ul>
      </div>

      <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-5">
        <h2 class="font-bold text-green-800 dark:text-green-200 mb-3">Popular D-Day Uses</h2>
        <div class="grid grid-cols-2 gap-4 text-sm text-green-700 dark:text-green-300">
          <div>
            <p>• Exam countdown (SAT, finals)</p>
            <p>• Wedding day planning</p>
            <p>• Vacation departure</p>
            <p>• Project deadlines</p>
          </div>
          <div>
            <p>• Anniversary tracking</p>
            <p>• Baby due date</p>
            <p>• Contract expiration</p>
            <p>• Retirement countdown</p>
          </div>
        </div>
      </div>

      <div class="bg-purple-50 dark:bg-purple-900/20 rounded-xl p-5">
        <h2 class="font-bold text-purple-800 dark:text-purple-200 mb-3">Milestone Anniversaries</h2>
        <ul class="text-sm text-purple-700 dark:text-purple-300 space-y-1">
          <li>• <strong>100 days</strong>: First major milestone in relationships</li>
          <li>• <strong>365 days</strong>: One year anniversary</li>
          <li>• <strong>1,000 days</strong>: Approximately 2 years 9 months</li>
          <li>• <strong>10,000 days</strong>: About 27 years 4 months - a lifetime milestone</li>
        </ul>
      </div>
    </div>

    <!-- Back Link -->
    <div class="mt-8 text-center">
      <a href="/en/tools" class="text-primary-600 dark:text-primary-400 hover:underline">
        ← Back to Tools
      </a>
    </div>
  </div>
</Layout>

<script>
  const targetDateInput = document.getElementById('target-date') as HTMLInputElement;
  const eventNameInput = document.getElementById('event-name') as HTMLInputElement;
  const calculateBtn = document.getElementById('calculate-btn');
  const resultArea = document.getElementById('result-area');
  const eventDisplay = document.getElementById('event-display');
  const ddayResult = document.getElementById('dday-result');
  const dateDisplay = document.getElementById('date-display');
  const weeksEl = document.getElementById('weeks');
  const hoursEl = document.getElementById('hours');
  const minutesEl = document.getElementById('minutes');

  // Set default date to today
  const today = new Date();
  targetDateInput.value = today.toISOString().split('T')[0];

  function formatDate(date: Date): string {
    return date.toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      weekday: 'long'
    });
  }

  function calculate() {
    const targetDate = new Date(targetDateInput.value);
    const now = new Date();
    now.setHours(0, 0, 0, 0);
    targetDate.setHours(0, 0, 0, 0);

    const diffTime = targetDate.getTime() - now.getTime();
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    const eventName = eventNameInput.value || 'Target Date';

    resultArea?.classList.remove('hidden');

    if (eventDisplay) eventDisplay.textContent = eventName;
    if (dateDisplay) dateDisplay.textContent = formatDate(targetDate);

    if (diffDays > 0) {
      if (ddayResult) ddayResult.textContent = `D-${diffDays}`;
    } else if (diffDays < 0) {
      if (ddayResult) ddayResult.textContent = `D+${Math.abs(diffDays)}`;
    } else {
      if (ddayResult) ddayResult.textContent = 'D-Day!';
    }

    const absDays = Math.abs(diffDays);
    const weeks = Math.floor(absDays / 7);
    const hours = absDays * 24;
    const minutes = hours * 60;

    if (weeksEl) weeksEl.textContent = weeks.toLocaleString();
    if (hoursEl) hoursEl.textContent = hours.toLocaleString();
    if (minutesEl) minutesEl.textContent = minutes.toLocaleString();
  }

  calculateBtn?.addEventListener('click', calculate);
  targetDateInput?.addEventListener('change', calculate);

  // Initial calculation
  calculate();
</script>
