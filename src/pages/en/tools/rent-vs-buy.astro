---
import Layout from '../../../layouts/Layout.astro';
import AdBanner from '../../../components/AdBanner.astro';
import ToolSeoContent from '../../../components/ToolSeoContent.astro';
import { getTool, generateToolBreadcrumbSchema, generateToolHowToSchema, calculatorSteps, getToolStepType } from '../../../utils/tools';

const lang = 'en';
const tool = getTool('rent-vs-buy', lang);
const siteUrl = 'https://judysylph.com';
const stepType = getToolStepType('rent-vs-buy');
const steps = calculatorSteps[lang][stepType];

const webAppSchema = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": tool?.title,
  "description": tool?.description,
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "All",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" }
};

const breadcrumbSchema = tool ? generateToolBreadcrumbSchema(tool, lang, siteUrl) : null;
const howToSchema = tool ? generateToolHowToSchema(tool, lang, siteUrl, steps) : null;
const jsonLd = [webAppSchema, breadcrumbSchema, howToSchema].filter(Boolean);
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description} jsonLd={jsonLd}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <form id="calc-form" class="space-y-6">
        <div class="grid grid-cols-2 gap-4">
          <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4">
            <h3 class="font-bold text-blue-800 dark:text-blue-200 mb-3">üè† Buying</h3>
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Home Price</label>
                <input type="text" id="homePrice" placeholder="400,000" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Down Payment (%)</label>
                <input type="number" id="downPayment" placeholder="20" value="20" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Mortgage Rate (%)</label>
                <input type="number" id="mortgageRate" placeholder="6.5" step="0.1" value="6.5" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
              </div>
            </div>
          </div>

          <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-4">
            <h3 class="font-bold text-green-800 dark:text-green-200 mb-3">üè¢ Renting</h3>
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Monthly Rent</label>
                <input type="text" id="monthlyRent" placeholder="2,000" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Annual Rent Increase (%)</label>
                <input type="number" id="rentIncrease" placeholder="3" value="3" step="0.5" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Security Deposit</label>
                <input type="text" id="securityDeposit" placeholder="4,000" value="4000" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
              </div>
            </div>
          </div>
        </div>

        <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4">
          <div class="grid grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Time Horizon (years)</label>
              <select id="years" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                <option value="3">3 years</option>
                <option value="5" selected>5 years</option>
                <option value="7">7 years</option>
                <option value="10">10 years</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Home Appreciation (%/yr)</label>
              <input type="number" id="appreciation" placeholder="3" value="3" step="0.5" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Investment Return (%/yr)</label>
              <input type="number" id="investReturn" placeholder="7" value="7" step="0.5" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
            </div>
          </div>
        </div>

        <button type="submit" class="w-full px-6 py-3 bg-primary-600 text-white rounded-xl font-medium hover:bg-primary-700">Compare Options</button>
      </form>

      <div id="result-area" class="mt-8 hidden">
        <div id="result-header" class="rounded-2xl p-6 text-white text-center mb-6">
          <div id="verdict-emoji" class="text-5xl mb-2"></div>
          <div id="verdict" class="text-2xl font-bold mb-2"></div>
          <div id="verdict-desc" class="text-lg opacity-90"></div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
          <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4">
            <h4 class="font-bold text-blue-800 dark:text-blue-200 mb-3 text-center">üè† Buy</h4>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Down Payment</span><span id="b-down" class="font-medium">-</span></div>
              <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Monthly Payment</span><span id="b-monthly" class="font-medium">-</span></div>
              <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Total Costs</span><span id="b-total" class="font-medium">-</span></div>
              <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Home Equity</span><span id="b-equity" class="font-medium text-green-600">-</span></div>
              <div class="flex justify-between border-t pt-2"><span class="font-medium">Net Cost</span><span id="b-net" class="font-bold">-</span></div>
            </div>
          </div>
          <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-4">
            <h4 class="font-bold text-green-800 dark:text-green-200 mb-3 text-center">üè¢ Rent</h4>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Security Deposit</span><span id="r-deposit" class="font-medium">-</span></div>
              <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Avg Monthly</span><span id="r-monthly" class="font-medium">-</span></div>
              <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Total Rent Paid</span><span id="r-total" class="font-medium">-</span></div>
              <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Investment Gain</span><span id="r-invest" class="font-medium text-green-600">-</span></div>
              <div class="flex justify-between border-t pt-2"><span class="font-medium">Net Cost</span><span id="r-net" class="font-bold">-</span></div>
            </div>
          </div>
        </div>

        <div class="bg-primary-50 dark:bg-primary-900/20 rounded-xl p-5">
          <h3 class="text-lg font-semibold text-primary-800 dark:text-primary-200 mb-3">üîó Related Calculators</h3>
          <div class="flex flex-wrap gap-2">
            <a href="/en/tools/mortgage-calculator" class="px-4 py-2 bg-white dark:bg-gray-800 rounded-lg text-primary-600 dark:text-primary-400 hover:bg-primary-100 dark:hover:bg-gray-700 transition-colors">üè¶ Mortgage Calculator</a>
            <a href="/en/tools/apartment-affordability" class="px-4 py-2 bg-white dark:bg-gray-800 rounded-lg text-primary-600 dark:text-primary-400 hover:bg-primary-100 dark:hover:bg-gray-700 transition-colors">üè¢ Home Affordability</a>
          </div>
        </div>
      </div>
    </div>
    <AdBanner className="mt-8" />

    <!-- SEO Content -->
    <ToolSeoContent
      title={tool?.title || ''}
      description={tool?.description || ''}
      emoji={tool?.emoji || ''}
      category={tool?.category || ''}
      lang={lang}
      slug={tool?.slug || ''}
    />

    <div class="mt-8 text-center"><a href="/en/tools" class="text-primary-600 dark:text-primary-400 hover:underline">‚Üê Back to Tools</a></div>
  </div>
</Layout>

<script>
  const form = document.getElementById('calc-form') as HTMLFormElement;
  ['homePrice', 'monthlyRent', 'securityDeposit'].forEach(id => {
    const el = document.getElementById(id) as HTMLInputElement;
    el?.addEventListener('input', e => {
      const v = (e.target as HTMLInputElement).value.replace(/\D/g,'');
      (e.target as HTMLInputElement).value = Number(v).toLocaleString();
    });
  });

  function calcMonthly(p: number, r: number, n: number): number {
    const mr = r / 100 / 12;
    return p * mr * Math.pow(1+mr, n) / (Math.pow(1+mr, n) - 1);
  }

  form?.addEventListener('submit', e => {
    e.preventDefault();
    const homePrice = parseInt((document.getElementById('homePrice') as HTMLInputElement).value.replace(/,/g,''));
    const downPaymentPct = parseFloat((document.getElementById('downPayment') as HTMLInputElement).value) / 100;
    const mortgageRate = parseFloat((document.getElementById('mortgageRate') as HTMLInputElement).value);
    const monthlyRent = parseInt((document.getElementById('monthlyRent') as HTMLInputElement).value.replace(/,/g,''));
    const rentIncrease = parseFloat((document.getElementById('rentIncrease') as HTMLInputElement).value) / 100;
    const securityDeposit = parseInt((document.getElementById('securityDeposit') as HTMLInputElement).value.replace(/,/g,''));
    const years = parseInt((document.getElementById('years') as HTMLSelectElement).value);
    const appreciation = parseFloat((document.getElementById('appreciation') as HTMLInputElement).value) / 100;
    const investReturn = parseFloat((document.getElementById('investReturn') as HTMLInputElement).value) / 100;

    const months = years * 12;
    const downPayment = homePrice * downPaymentPct;
    const loanAmount = homePrice - downPayment;
    const mortgageMonthly = calcMonthly(loanAmount, mortgageRate, 360);

    // Buy costs
    const closingCosts = homePrice * 0.03;
    const propertyTaxYearly = homePrice * 0.012;
    const maintenanceYearly = homePrice * 0.01;
    const insuranceYearly = 1500;
    const buyMonthlyExtras = (propertyTaxYearly + maintenanceYearly + insuranceYearly) / 12;
    const buyTotalMonthly = mortgageMonthly + buyMonthlyExtras;
    const buyTotalCost = downPayment + closingCosts + buyTotalMonthly * months;

    // Home equity after years
    const futureHomeValue = homePrice * Math.pow(1 + appreciation, years);
    let remainingLoan = loanAmount;
    const mr = mortgageRate / 100 / 12;
    for (let i = 0; i < months; i++) {
      const interest = remainingLoan * mr;
      remainingLoan -= (mortgageMonthly - interest);
    }
    const homeEquity = futureHomeValue - remainingLoan;
    const buyNetCost = buyTotalCost - homeEquity;

    // Rent costs
    let totalRent = 0;
    let currentRent = monthlyRent;
    for (let y = 0; y < years; y++) {
      totalRent += currentRent * 12;
      currentRent *= (1 + rentIncrease);
    }
    const avgRent = totalRent / months;

    // Investment of difference
    const investableAmount = downPayment + closingCosts - securityDeposit;
    const investmentGain = investableAmount * (Math.pow(1 + investReturn, years) - 1);
    const rentNetCost = totalRent - investmentGain;

    document.getElementById('result-area')?.classList.remove('hidden');

    const header = document.getElementById('result-header')!;
    const diff = buyNetCost - rentNetCost;

    if (diff < -10000) {
      header.className = 'bg-gradient-to-br from-blue-500 to-cyan-600 rounded-2xl p-6 text-white text-center mb-6';
      document.getElementById('verdict-emoji')!.textContent = 'üè†';
      document.getElementById('verdict')!.textContent = 'Buying is Better!';
      document.getElementById('verdict-desc')!.textContent = `Save $${Math.round(Math.abs(diff)).toLocaleString()} over ${years} years`;
    } else if (diff > 10000) {
      header.className = 'bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl p-6 text-white text-center mb-6';
      document.getElementById('verdict-emoji')!.textContent = 'üè¢';
      document.getElementById('verdict')!.textContent = 'Renting is Better!';
      document.getElementById('verdict-desc')!.textContent = `Save $${Math.round(diff).toLocaleString()} over ${years} years`;
    } else {
      header.className = 'bg-gradient-to-br from-gray-500 to-slate-600 rounded-2xl p-6 text-white text-center mb-6';
      document.getElementById('verdict-emoji')!.textContent = '‚öñÔ∏è';
      document.getElementById('verdict')!.textContent = 'About Equal';
      document.getElementById('verdict-desc')!.textContent = 'Choose based on lifestyle preferences';
    }

    document.getElementById('b-down')!.textContent = '$' + Math.round(downPayment).toLocaleString();
    document.getElementById('b-monthly')!.textContent = '$' + Math.round(buyTotalMonthly).toLocaleString();
    document.getElementById('b-total')!.textContent = '$' + Math.round(buyTotalCost).toLocaleString();
    document.getElementById('b-equity')!.textContent = '+$' + Math.round(homeEquity).toLocaleString();
    document.getElementById('b-net')!.textContent = '$' + Math.round(buyNetCost).toLocaleString();

    document.getElementById('r-deposit')!.textContent = '$' + securityDeposit.toLocaleString();
    document.getElementById('r-monthly')!.textContent = '$' + Math.round(avgRent).toLocaleString();
    document.getElementById('r-total')!.textContent = '$' + Math.round(totalRent).toLocaleString();
    document.getElementById('r-invest')!.textContent = '+$' + Math.round(investmentGain).toLocaleString();
    document.getElementById('r-net')!.textContent = '$' + Math.round(rentNetCost).toLocaleString();
  });
</script>
