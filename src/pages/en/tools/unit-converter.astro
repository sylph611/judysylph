---
import Layout from '../../../layouts/Layout.astro';
import AdBanner from '../../../components/AdBanner.astro';
import { getTool, generateToolBreadcrumbSchema, generateToolHowToSchema, calculatorSteps, getToolStepType } from '../../../utils/tools';

const lang = 'en';
const tool = getTool('unit-converter', lang);

const siteUrl = 'https://judysylph.com';
const stepType = getToolStepType('unit-converter');
const steps = calculatorSteps['en'][stepType];

const webAppSchema = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": tool?.title,
  "description": tool?.description,
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "All",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" }
};

const breadcrumbSchema = tool ? generateToolBreadcrumbSchema(tool, 'en', siteUrl) : null;
const howToSchema = tool ? generateToolHowToSchema(tool, 'en', siteUrl, steps) : null;

const jsonLd = [webAppSchema, breadcrumbSchema, howToSchema].filter(Boolean);
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description} jsonLd={jsonLd}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
    </div>

    <!-- Tool Area -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <!-- Category Tabs -->
      <div class="flex gap-2 mb-6 flex-wrap">
        <button class="tab-btn active px-4 py-2 rounded-lg font-medium transition-colors" data-category="length">Length</button>
        <button class="tab-btn px-4 py-2 rounded-lg font-medium transition-colors" data-category="weight">Weight</button>
        <button class="tab-btn px-4 py-2 rounded-lg font-medium transition-colors" data-category="temperature">Temperature</button>
        <button class="tab-btn px-4 py-2 rounded-lg font-medium transition-colors" data-category="area">Area</button>
      </div>

      <!-- Converter -->
      <div class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Value to Convert</label>
            <input
              type="number"
              id="input-value"
              placeholder="0"
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Unit</label>
            <select
              id="from-unit"
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
            >
            </select>
          </div>
        </div>

        <!-- Result -->
        <div id="results" class="grid grid-cols-2 md:grid-cols-3 gap-4">
        </div>
      </div>
    </div>

    <!-- Info Section -->
    <div class="mt-8 space-y-4">
      <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-5">
        <h2 class="font-bold text-blue-800 dark:text-blue-200 mb-3">Common Length Conversions</h2>
        <div class="grid grid-cols-2 gap-4 text-sm text-blue-700 dark:text-blue-300">
          <div>
            <p>• 1 inch = 2.54 cm</p>
            <p>• 1 foot = 30.48 cm</p>
            <p>• 1 mile = 1.609 km</p>
          </div>
          <div>
            <p>• 1 meter = 3.28 feet</p>
            <p>• 1 km = 0.621 miles</p>
            <p>• 1 yard = 91.44 cm</p>
          </div>
        </div>
      </div>

      <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-5">
        <h2 class="font-bold text-green-800 dark:text-green-200 mb-3">Common Weight Conversions</h2>
        <div class="grid grid-cols-2 gap-4 text-sm text-green-700 dark:text-green-300">
          <div>
            <p>• 1 ounce = 28.35 g</p>
            <p>• 1 pound = 453.6 g</p>
            <p>• 1 kg = 2.205 pounds</p>
          </div>
          <div>
            <p>• 1 stone = 6.35 kg</p>
            <p>• 1 short ton = 907.2 kg</p>
            <p>• 1 metric ton = 1,000 kg</p>
          </div>
        </div>
      </div>

      <div class="bg-purple-50 dark:bg-purple-900/20 rounded-xl p-5">
        <h2 class="font-bold text-purple-800 dark:text-purple-200 mb-3">Temperature Conversion Formulas</h2>
        <ul class="text-sm text-purple-700 dark:text-purple-300 space-y-2">
          <li>• <strong>Celsius to Fahrenheit</strong>: °F = (°C × 9/5) + 32</li>
          <li>• <strong>Fahrenheit to Celsius</strong>: °C = (°F - 32) × 5/9</li>
          <li>• <strong>Celsius to Kelvin</strong>: K = °C + 273.15</li>
          <li>• Water freezes: 0°C = 32°F = 273.15K</li>
          <li>• Water boils: 100°C = 212°F = 373.15K</li>
        </ul>
      </div>

      <div class="bg-orange-50 dark:bg-orange-900/20 rounded-xl p-5">
        <h2 class="font-bold text-orange-800 dark:text-orange-200 mb-3">Area Conversions (Real Estate)</h2>
        <ul class="text-sm text-orange-700 dark:text-orange-300 space-y-1">
          <li>• <strong>1 acre</strong> = 43,560 sq ft = 4,047 m²</li>
          <li>• <strong>1 hectare</strong> = 10,000 m² = 2.47 acres</li>
          <li>• <strong>1 sq meter</strong> = 10.76 sq ft</li>
          <li>• <strong>1 sq mile</strong> = 640 acres = 2.59 km²</li>
          <li>• <strong>1 pyeong</strong> = 3.3 m² (Korean unit)</li>
        </ul>
      </div>
    </div>

    <!-- Back Link -->
    <AdBanner className="mt-8" />

    <div class="mt-8 text-center">
      <a href="/en/tools" class="text-primary-600 dark:text-primary-400 hover:underline">
        ← Back to Tools
      </a>
    </div>
  </div>
</Layout>

<style>
  .tab-btn {
    background-color: rgb(243 244 246);
    color: rgb(75 85 99);
  }
  .tab-btn:hover {
    background-color: rgb(229 231 235);
  }
  .tab-btn.active {
    background-color: rgb(14 165 233);
    color: white;
  }
  :global(.dark) .tab-btn {
    background-color: rgb(55 65 81);
    color: rgb(209 213 219);
  }
  :global(.dark) .tab-btn:hover {
    background-color: rgb(75 85 99);
  }
  :global(.dark) .tab-btn.active {
    background-color: rgb(14 165 233);
    color: white;
  }
</style>

<script>
  const units: Record<string, { name: string; toBase: (v: number) => number; fromBase: (v: number) => number }[]> = {
    length: [
      { name: 'Millimeter (mm)', toBase: v => v / 1000, fromBase: v => v * 1000 },
      { name: 'Centimeter (cm)', toBase: v => v / 100, fromBase: v => v * 100 },
      { name: 'Meter (m)', toBase: v => v, fromBase: v => v },
      { name: 'Kilometer (km)', toBase: v => v * 1000, fromBase: v => v / 1000 },
      { name: 'Inch (in)', toBase: v => v * 0.0254, fromBase: v => v / 0.0254 },
      { name: 'Foot (ft)', toBase: v => v * 0.3048, fromBase: v => v / 0.3048 },
      { name: 'Mile (mi)', toBase: v => v * 1609.344, fromBase: v => v / 1609.344 },
    ],
    weight: [
      { name: 'Milligram (mg)', toBase: v => v / 1000000, fromBase: v => v * 1000000 },
      { name: 'Gram (g)', toBase: v => v / 1000, fromBase: v => v * 1000 },
      { name: 'Kilogram (kg)', toBase: v => v, fromBase: v => v },
      { name: 'Metric Ton (t)', toBase: v => v * 1000, fromBase: v => v / 1000 },
      { name: 'Ounce (oz)', toBase: v => v * 0.0283495, fromBase: v => v / 0.0283495 },
      { name: 'Pound (lb)', toBase: v => v * 0.453592, fromBase: v => v / 0.453592 },
    ],
    temperature: [
      { name: 'Celsius (°C)', toBase: v => v, fromBase: v => v },
      { name: 'Fahrenheit (°F)', toBase: v => (v - 32) * 5/9, fromBase: v => v * 9/5 + 32 },
      { name: 'Kelvin (K)', toBase: v => v - 273.15, fromBase: v => v + 273.15 },
    ],
    area: [
      { name: 'Square Meter (m²)', toBase: v => v, fromBase: v => v },
      { name: 'Square Kilometer (km²)', toBase: v => v * 1000000, fromBase: v => v / 1000000 },
      { name: 'Pyeong (평)', toBase: v => v * 3.305785, fromBase: v => v / 3.305785 },
      { name: 'Square Foot (ft²)', toBase: v => v * 0.092903, fromBase: v => v / 0.092903 },
      { name: 'Acre', toBase: v => v * 4046.86, fromBase: v => v / 4046.86 },
    ],
  };

  let currentCategory = 'length';

  const tabBtns = document.querySelectorAll('.tab-btn');
  const fromUnitSelect = document.getElementById('from-unit') as HTMLSelectElement;
  const inputValue = document.getElementById('input-value') as HTMLInputElement;
  const resultsDiv = document.getElementById('results');

  function updateUnits() {
    const categoryUnits = units[currentCategory];
    fromUnitSelect.innerHTML = categoryUnits.map((u, i) =>
      `<option value="${i}">${u.name}</option>`
    ).join('');
    convert();
  }

  function convert() {
    const value = parseFloat(inputValue.value) || 0;
    const fromIndex = parseInt(fromUnitSelect.value);
    const categoryUnits = units[currentCategory];
    const baseValue = categoryUnits[fromIndex].toBase(value);

    if (resultsDiv) {
      resultsDiv.innerHTML = categoryUnits.map((unit, i) => {
        if (i === fromIndex) return '';
        const converted = unit.fromBase(baseValue);
        const displayValue = Math.abs(converted) < 0.01 || Math.abs(converted) > 999999
          ? converted.toExponential(4)
          : converted.toLocaleString('en-US', { maximumFractionDigits: 6 });
        return `
          <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4">
            <div class="text-lg font-bold text-primary-600 dark:text-primary-400">${displayValue}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">${unit.name}</div>
          </div>
        `;
      }).join('');
    }
  }

  tabBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      tabBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentCategory = btn.getAttribute('data-category') || 'length';
      updateUnits();
    });
  });

  fromUnitSelect?.addEventListener('change', convert);
  inputValue?.addEventListener('input', convert);

  updateUnits();
</script>
