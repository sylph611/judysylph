---
import Layout from '../../layouts/Layout.astro';
import TestCard from '../../components/TestCard.astro';
import ToolCard from '../../components/ToolCard.astro';
import SearchBar from '../../components/SearchBar.astro';
import TestCardSkeleton from '../../components/TestCardSkeleton.astro';
import ToolCardSkeleton from '../../components/ToolCardSkeleton.astro';
import RecentTests from '../../components/RecentTests.astro';
import { getTestMeta, categoryLabels } from '../../utils/tests';
import { getAllTools } from '../../utils/tools';
import { useTranslations } from '../../i18n';

const lang = 'ko';
const t = useTranslations(lang);
const tests = getTestMeta(lang);
const tools = getAllTools(lang);
const categories = categoryLabels.ko;
---

<Layout title={t('site.title')} description={t('site.description')}>
  <!-- Hero Section -->
  <section class="bg-gradient-to-br from-primary-500 to-secondary-500 text-white py-16 md:py-24">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <h1 class="text-4xl md:text-5xl font-bold mb-4">
        {t('home.hero')}
      </h1>
      <p class="text-xl md:text-2xl opacity-90 mb-8">
        {t('home.heroSub')}
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a
          href="#tests"
          class="inline-block px-8 py-4 bg-white text-primary-600 font-bold rounded-full hover:bg-gray-100 transition-colors shadow-lg"
        >
          {t('home.startTest')}
        </a>
        <a
          href="#tools"
          class="inline-block px-8 py-4 bg-white/20 text-white font-bold rounded-full hover:bg-white/30 transition-colors border-2 border-white/50"
        >
          {t('tools.title')}
        </a>
      </div>
    </div>
  </section>

  <!-- Search Section -->
  <section class="py-8 -mb-8">
    <div class="max-w-6xl mx-auto px-4">
      <SearchBar lang={lang} />
    </div>
  </section>

  <!-- Recent Tests Section -->
  <RecentTests lang={lang} />

  <!-- Tests Section -->
  <section id="tests" class="py-16">
    <div class="max-w-6xl mx-auto px-4">
      <h2 class="text-3xl font-bold text-center mb-8 text-gray-900 dark:text-white">
        {t('home.allTests')}
      </h2>

      <!-- Category Filter -->
      <div class="flex flex-wrap justify-center gap-2 mb-8">
        <button
          data-category="all"
          class="category-btn px-4 py-2 rounded-full font-medium transition-all bg-primary-600 text-white"
        >
          {categories.all}
        </button>
        <button
          data-category="personality"
          class="category-btn px-4 py-2 rounded-full font-medium transition-all bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"
        >
          {categories.personality}
        </button>
        <button
          data-category="love"
          class="category-btn px-4 py-2 rounded-full font-medium transition-all bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"
        >
          {categories.love}
        </button>
        <button
          data-category="career"
          class="category-btn px-4 py-2 rounded-full font-medium transition-all bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"
        >
          {categories.career}
        </button>
        <button
          data-category="lifestyle"
          class="category-btn px-4 py-2 rounded-full font-medium transition-all bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"
        >
          {categories.lifestyle}
        </button>
        <button
          data-category="fun"
          class="category-btn px-4 py-2 rounded-full font-medium transition-all bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"
        >
          {categories.fun}
        </button>
      </div>

      <!-- Skeleton Grid (shown during transitions) -->
      <div id="test-skeleton-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden">
        {[1, 2, 3, 4, 5, 6].map(() => (
          <TestCardSkeleton />
        ))}
      </div>

      <div id="test-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {tests.map((test, index) => (
          <div
            class="test-card animate-fade-in"
            data-category={test.category}
            style={`animation-delay: ${index * 50}ms`}
          >
            <TestCard
              slug={test.slug}
              title={test.title}
              description={test.description}
              emoji={test.emoji}
              questionCount={test.questionCount}
              lang={lang}
            />
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Tools Section -->
  <section id="tools" class="py-16 bg-gray-50 dark:bg-gray-800/50">
    <div class="max-w-6xl mx-auto px-4">
      <h2 class="text-3xl font-bold text-center mb-4 text-gray-900 dark:text-white">
        {t('tools.title')}
      </h2>
      <p class="text-center text-gray-600 dark:text-gray-400 mb-12">
        {t('tools.description')}
      </p>

      <!-- Skeleton Grid (shown during transitions) -->
      <div id="tool-skeleton-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden">
        {[1, 2, 3].map(() => (
          <ToolCardSkeleton />
        ))}
      </div>

      <div id="tool-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {tools.map((tool, index) => (
          <div class="animate-fade-in" style={`animation-delay: ${index * 50}ms`}>
            <ToolCard
              slug={tool.slug}
              title={tool.title}
              description={tool.description}
              emoji={tool.emoji}
              category={tool.category}
              lang={lang}
            />
          </div>
        ))}
      </div>

      <div class="text-center mt-8">
        <a href={`/${lang}/tools`} class="text-primary-600 dark:text-primary-400 hover:underline font-medium">
          모든 도구 보기 →
        </a>
      </div>
    </div>
  </section>

  <!-- About Section -->
  <section class="py-16">
    <div class="max-w-4xl mx-auto px-4 text-center">
      <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-white">
        JudySylph 소개
      </h2>
      <p class="text-gray-600 dark:text-gray-300 leading-relaxed">
        JudySylph는 재미있고 통찰력 있는 심리 테스트와 유용한 도구를 제공합니다.
        자신의 성격, 연애 스타일, 스트레스 대처 방식 등을 알아보고,
        일상에서 필요한 다양한 계산과 변환도 간편하게 이용해보세요.
        모든 서비스는 무료이며, 결과를 친구들과 공유할 수 있습니다.
      </p>
    </div>
  </section>
</Layout>

<style>
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fadeIn 0.4s ease-out forwards;
    opacity: 0;
  }
</style>

<script>
  // Category filter
  const categoryBtns = document.querySelectorAll('.category-btn');
  const testCards = document.querySelectorAll('.test-card');
  const testSkeletonGrid = document.getElementById('test-skeleton-grid');
  const testGrid = document.getElementById('test-grid');

  categoryBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const category = btn.getAttribute('data-category');

      // Update button styles
      categoryBtns.forEach(b => {
        b.classList.remove('bg-primary-600', 'text-white');
        b.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
      });
      btn.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
      btn.classList.add('bg-primary-600', 'text-white');

      // Show skeleton during filter transition
      if (testSkeletonGrid && testGrid) {
        testSkeletonGrid.classList.remove('hidden');
        testGrid.classList.add('opacity-0');

        setTimeout(() => {
          // Filter cards
          testCards.forEach(card => {
            if (category === 'all' || card.getAttribute('data-category') === category) {
              (card as HTMLElement).style.display = 'block';
            } else {
              (card as HTMLElement).style.display = 'none';
            }
          });

          testSkeletonGrid.classList.add('hidden');
          testGrid.classList.remove('opacity-0');
        }, 200);
      } else {
        // Fallback without skeleton
        testCards.forEach(card => {
          if (category === 'all' || card.getAttribute('data-category') === category) {
            (card as HTMLElement).style.display = 'block';
          } else {
            (card as HTMLElement).style.display = 'none';
          }
        });
      }

      // GA event
      if (typeof gtag !== 'undefined') {
        gtag('event', 'filter_category', {
          event_category: 'engagement',
          event_label: category
        });
      }
    });
  });
</script>
