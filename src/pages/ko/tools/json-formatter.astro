---
import Layout from '../../../layouts/Layout.astro';
import AdBanner from '../../../components/AdBanner.astro';
import ToolSeoContent from '../../../components/ToolSeoContent.astro';
import { getTool, generateToolBreadcrumbSchema, generateToolHowToSchema, calculatorSteps, getToolStepType } from '../../../utils/tools';

const lang = 'ko';
const tool = getTool('json-formatter', lang);

const siteUrl = 'https://judysylph.com';
const stepType = getToolStepType('json-formatter');
const steps = calculatorSteps['ko'][stepType];

const webAppSchema = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": tool?.title,
  "description": tool?.description,
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "All",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "KRW" }
};

const breadcrumbSchema = tool ? generateToolBreadcrumbSchema(tool, 'ko', siteUrl) : null;
const howToSchema = tool ? generateToolHowToSchema(tool, 'ko', siteUrl, steps) : null;

const jsonLd = [webAppSchema, breadcrumbSchema, howToSchema].filter(Boolean);
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description} jsonLd={jsonLd}>
  <div class="max-w-6xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
    </div>

    <!-- Tool Area -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Input -->
        <div>
          <div class="flex justify-between items-center mb-2">
            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">입력</label>
            <button id="paste-btn" class="text-sm text-primary-600 dark:text-primary-400 hover:underline">붙여넣기</button>
          </div>
          <textarea
            id="json-input"
            rows="20"
            placeholder='{"key": "value"}'
            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none"
          ></textarea>
        </div>

        <!-- Output -->
        <div>
          <div class="flex justify-between items-center mb-2">
            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">출력</label>
            <button id="copy-btn" class="text-sm text-primary-600 dark:text-primary-400 hover:underline">복사</button>
          </div>
          <textarea
            id="json-output"
            rows="20"
            readonly
            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white font-mono text-sm resize-none"
          ></textarea>
        </div>
      </div>

      <!-- Buttons -->
      <div class="flex flex-wrap gap-3 mt-6">
        <button
          id="format-btn"
          class="px-6 py-3 bg-primary-600 text-white rounded-xl font-medium hover:bg-primary-700 transition-colors"
        >
          포맷하기
        </button>
        <button
          id="minify-btn"
          class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-xl font-medium hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
        >
          압축하기
        </button>
        <button
          id="clear-btn"
          class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-xl font-medium hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
        >
          지우기
        </button>
      </div>

      <!-- Status -->
      <div id="status" class="mt-4 hidden">
        <div id="status-message" class="px-4 py-2 rounded-lg text-sm"></div>
      </div>
    </div>

    <!-- Info Section -->
    <div class="mt-8 space-y-4">
      <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-5">
        <h2 class="font-bold text-blue-800 dark:text-blue-200 mb-3">JSON이란?</h2>
        <ul class="text-sm text-blue-700 dark:text-blue-300 space-y-2">
          <li>• <strong>JSON (JavaScript Object Notation)</strong>: 데이터 교환을 위한 경량 텍스트 형식입니다.</li>
          <li>• 사람이 읽고 쓰기 쉽고, 기계가 파싱하고 생성하기 쉽습니다.</li>
          <li>• API 통신, 설정 파일, 데이터 저장 등에 널리 사용됩니다.</li>
          <li>• XML보다 간결하여 웹 개발에서 표준으로 자리잡았습니다.</li>
        </ul>
      </div>

      <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-5">
        <h2 class="font-bold text-green-800 dark:text-green-200 mb-3">JSON 기본 문법</h2>
        <div class="text-sm text-green-700 dark:text-green-300 space-y-2">
          <p>• <strong>객체</strong>: 중괄호로 감싸고 키-값 쌍으로 구성</p>
          <p>• <strong>배열</strong>: 대괄호로 감싸고 쉼표로 구분</p>
          <p>• <strong>문자열</strong>: 반드시 큰따옴표(") 사용 (작은따옴표 불가)</p>
          <p>• <strong>숫자</strong>: 따옴표 없이 작성 (정수, 소수 가능)</p>
          <p>• <strong>불리언</strong>: true 또는 false (소문자만 가능)</p>
          <p>• <strong>null</strong>: 빈 값을 나타냄 (소문자)</p>
        </div>
      </div>

      <div class="bg-red-50 dark:bg-red-900/20 rounded-xl p-5">
        <h2 class="font-bold text-red-800 dark:text-red-200 mb-3">자주 발생하는 JSON 오류</h2>
        <ul class="text-sm text-red-700 dark:text-red-300 space-y-1">
          <li>• <strong>마지막 쉼표</strong>: 마지막 항목 뒤에 쉼표가 있으면 오류</li>
          <li>• <strong>작은따옴표 사용</strong>: 문자열은 반드시 큰따옴표만 가능</li>
          <li>• <strong>주석 사용</strong>: JSON은 주석을 지원하지 않음</li>
          <li>• <strong>키에 따옴표 누락</strong>: 모든 키는 문자열이어야 함</li>
          <li>• <strong>undefined 사용</strong>: null은 가능하지만 undefined는 불가</li>
        </ul>
      </div>

      <div class="bg-purple-50 dark:bg-purple-900/20 rounded-xl p-5">
        <h2 class="font-bold text-purple-800 dark:text-purple-200 mb-3">JSON 활용 분야</h2>
        <ul class="text-sm text-purple-700 dark:text-purple-300 space-y-1">
          <li>• <strong>REST API</strong>: 서버-클라이언트 간 데이터 통신</li>
          <li>• <strong>설정 파일</strong>: package.json, tsconfig.json 등</li>
          <li>• <strong>NoSQL DB</strong>: MongoDB, Firebase 데이터 저장</li>
          <li>• <strong>로컬 스토리지</strong>: 브라우저 데이터 저장</li>
        </ul>
      </div>
    </div>

    <!-- Back Link -->
    <AdBanner className="mt-8" />

    <!-- SEO Content -->
    <ToolSeoContent
      title={tool?.title || ''}
      description={tool?.description || ''}
      emoji={tool?.emoji || ''}
      category={tool?.category || ''}
      lang={lang}
      slug={tool?.slug || ''}
    />

    <div class="mt-8 text-center">
      <a href="/ko/tools" class="text-primary-600 dark:text-primary-400 hover:underline">
        ← 도구 목록으로 돌아가기
      </a>
    </div>
  </div>
</Layout>

<script>
  const jsonInput = document.getElementById('json-input') as HTMLTextAreaElement;
  const jsonOutput = document.getElementById('json-output') as HTMLTextAreaElement;
  const formatBtn = document.getElementById('format-btn');
  const minifyBtn = document.getElementById('minify-btn');
  const clearBtn = document.getElementById('clear-btn');
  const copyBtn = document.getElementById('copy-btn');
  const pasteBtn = document.getElementById('paste-btn');
  const status = document.getElementById('status');
  const statusMessage = document.getElementById('status-message');

  function showStatus(message: string, isError: boolean) {
    if (status && statusMessage) {
      status.classList.remove('hidden');
      statusMessage.textContent = message;
      statusMessage.className = `px-4 py-2 rounded-lg text-sm ${isError ? 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400' : 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'}`;
    }
  }

  function format() {
    try {
      const input = jsonInput.value.trim();
      if (!input) {
        showStatus('JSON을 입력해주세요', true);
        return;
      }
      const parsed = JSON.parse(input);
      jsonOutput.value = JSON.stringify(parsed, null, 2);
      showStatus('포맷 완료!', false);
    } catch (e) {
      showStatus('유효하지 않은 JSON입니다: ' + (e as Error).message, true);
    }
  }

  function minify() {
    try {
      const input = jsonInput.value.trim();
      if (!input) {
        showStatus('JSON을 입력해주세요', true);
        return;
      }
      const parsed = JSON.parse(input);
      jsonOutput.value = JSON.stringify(parsed);
      showStatus('압축 완료!', false);
    } catch (e) {
      showStatus('유효하지 않은 JSON입니다: ' + (e as Error).message, true);
    }
  }

  formatBtn?.addEventListener('click', format);
  minifyBtn?.addEventListener('click', minify);

  clearBtn?.addEventListener('click', () => {
    jsonInput.value = '';
    jsonOutput.value = '';
    status?.classList.add('hidden');
  });

  copyBtn?.addEventListener('click', async () => {
    const text = jsonOutput.value;
    if (!text) {
      showStatus('복사할 내용이 없습니다', true);
      return;
    }
    try {
      await navigator.clipboard.writeText(text);
      showStatus('복사되었습니다!', false);
    } catch {
      showStatus('복사에 실패했습니다', true);
    }
  });

  pasteBtn?.addEventListener('click', async () => {
    try {
      const text = await navigator.clipboard.readText();
      jsonInput.value = text;
      format();
    } catch {
      showStatus('붙여넣기에 실패했습니다', true);
    }
  });

  // Auto-format on input
  jsonInput?.addEventListener('input', () => {
    status?.classList.add('hidden');
  });
</script>
