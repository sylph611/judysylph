---
import Layout from '../../../layouts/Layout.astro';
import { getTool, generateToolBreadcrumbSchema, generateToolHowToSchema, calculatorSteps, getToolStepType } from '../../../utils/tools';

const lang = 'ko';
const tool = getTool('char-counter', lang);

const siteUrl = 'https://judysylph.com';
const stepType = getToolStepType('char-counter');
const steps = calculatorSteps['ko'][stepType];

const webAppSchema = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": tool?.title,
  "description": tool?.description,
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "All",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "KRW" }
};

const breadcrumbSchema = tool ? generateToolBreadcrumbSchema(tool, 'ko', siteUrl) : null;
const howToSchema = tool ? generateToolHowToSchema(tool, 'ko', siteUrl, steps) : null;

const jsonLd = [webAppSchema, breadcrumbSchema, howToSchema].filter(Boolean);
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description} jsonLd={jsonLd}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
    </div>

    <!-- Tool Area -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <!-- Input -->
      <div class="mb-6">
        <label for="text-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          텍스트 입력
        </label>
        <textarea
          id="text-input"
          rows="8"
          placeholder="여기에 텍스트를 입력하세요..."
          class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-y"
        ></textarea>
      </div>

      <!-- Buttons -->
      <div class="flex gap-3 mb-6">
        <button
          id="clear-btn"
          type="button"
          class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
        >
          지우기
        </button>
        <button
          id="copy-btn"
          type="button"
          class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors"
        >
          복사하기
        </button>
      </div>

      <!-- Results -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4 text-center">
          <div id="char-with-space" class="text-2xl font-bold text-primary-600 dark:text-primary-400">0</div>
          <div class="text-sm text-gray-600 dark:text-gray-400">공백 포함</div>
        </div>
        <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4 text-center">
          <div id="char-without-space" class="text-2xl font-bold text-primary-600 dark:text-primary-400">0</div>
          <div class="text-sm text-gray-600 dark:text-gray-400">공백 제외</div>
        </div>
        <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4 text-center">
          <div id="word-count" class="text-2xl font-bold text-primary-600 dark:text-primary-400">0</div>
          <div class="text-sm text-gray-600 dark:text-gray-400">단어수</div>
        </div>
        <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4 text-center">
          <div id="line-count" class="text-2xl font-bold text-primary-600 dark:text-primary-400">0</div>
          <div class="text-sm text-gray-600 dark:text-gray-400">줄수</div>
        </div>
      </div>

      <!-- Detailed Stats -->
      <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
          <span class="text-gray-600 dark:text-gray-400">한글</span>
          <span id="korean-count" class="font-medium text-gray-900 dark:text-white">0자</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
          <span class="text-gray-600 dark:text-gray-400">영문</span>
          <span id="english-count" class="font-medium text-gray-900 dark:text-white">0자</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
          <span class="text-gray-600 dark:text-gray-400">숫자</span>
          <span id="number-count" class="font-medium text-gray-900 dark:text-white">0개</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
          <span class="text-gray-600 dark:text-gray-400">공백</span>
          <span id="space-count" class="font-medium text-gray-900 dark:text-white">0개</span>
        </div>
      </div>
    </div>

    <!-- Info Section -->
    <div class="mt-8 space-y-4">
      <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-5">
        <h2 class="font-bold text-blue-800 dark:text-blue-200 mb-3">플랫폼별 글자 수 제한</h2>
        <div class="grid grid-cols-2 gap-4 text-sm text-blue-700 dark:text-blue-300">
          <div>
            <p>• <strong>X (트위터)</strong>: 280자</p>
            <p>• <strong>인스타그램 캡션</strong>: 2,200자</p>
            <p>• <strong>카카오톡 상태</strong>: 60자</p>
            <p>• <strong>유튜브 제목</strong>: 100자</p>
          </div>
          <div>
            <p>• <strong>SMS 문자</strong>: 80바이트 (한글 40자)</p>
            <p>• <strong>LMS 문자</strong>: 2,000바이트</p>
            <p>• <strong>네이버 블로그 제목</strong>: 100자</p>
            <p>• <strong>메타 설명</strong>: 160자 권장</p>
          </div>
        </div>
      </div>

      <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-5">
        <h2 class="font-bold text-green-800 dark:text-green-200 mb-3">글자 수 세기 팁</h2>
        <ul class="text-sm text-green-700 dark:text-green-300 space-y-1">
          <li>• <strong>공백 포함</strong>: 일반적인 글자 수 계산에 사용 (대부분의 SNS)</li>
          <li>• <strong>공백 제외</strong>: 원고료 계산, 논문 작성 시 주로 사용</li>
          <li>• <strong>바이트</strong>: SMS, 데이터베이스 저장 시 중요 (한글 2~3바이트)</li>
          <li>• <strong>단어 수</strong>: 영문 콘텐츠, 번역 작업 시 기준</li>
        </ul>
      </div>

      <div class="bg-purple-50 dark:bg-purple-900/20 rounded-xl p-5">
        <h2 class="font-bold text-purple-800 dark:text-purple-200 mb-3">활용 예시</h2>
        <ul class="text-sm text-purple-700 dark:text-purple-300 space-y-1">
          <li>• 블로그, SNS 게시물 작성 전 글자 수 확인</li>
          <li>• 자기소개서, 이력서 글자 수 맞추기</li>
          <li>• 광고 문구, 슬로건 글자 수 제한 확인</li>
          <li>• 번역 작업 시 원문/번역문 분량 비교</li>
          <li>• 논문, 리포트 작성 시 분량 체크</li>
        </ul>
      </div>
    </div>

    <!-- Back Link -->
    <div class="mt-8 text-center">
      <a href="/ko/tools" class="text-primary-600 dark:text-primary-400 hover:underline">
        ← 도구 목록으로 돌아가기
      </a>
    </div>
  </div>
</Layout>

<script>
  const textInput = document.getElementById('text-input') as HTMLTextAreaElement;
  const clearBtn = document.getElementById('clear-btn');
  const copyBtn = document.getElementById('copy-btn');

  const charWithSpace = document.getElementById('char-with-space');
  const charWithoutSpace = document.getElementById('char-without-space');
  const wordCount = document.getElementById('word-count');
  const koreanCount = document.getElementById('korean-count');
  const englishCount = document.getElementById('english-count');
  const numberCount = document.getElementById('number-count');
  const spaceCount = document.getElementById('space-count');
  const lineCount = document.getElementById('line-count');

  function analyzeText(text: string) {
    const totalChars = text.length;
    const charsNoSpace = text.replace(/\s/g, '').length;
    const words = text.trim().split(/\s+/).filter(word => word.length > 0);
    const totalWords = text.trim() === '' ? 0 : words.length;
    const koreanChars = text.match(/[가-힣]/g);
    const totalKorean = koreanChars ? koreanChars.length : 0;
    const englishChars = text.match(/[a-zA-Z]/g);
    const totalEnglish = englishChars ? englishChars.length : 0;
    const numbers = text.match(/[0-9]/g);
    const totalNumbers = numbers ? numbers.length : 0;
    const spaces = text.match(/\s/g);
    const totalSpaces = spaces ? spaces.length : 0;
    const lines = text.split('\n');
    const totalLines = text === '' ? 0 : lines.length;

    return { totalChars, charsNoSpace, totalWords, totalKorean, totalEnglish, totalNumbers, totalSpaces, totalLines };
  }

  function formatNumber(num: number) {
    return num.toLocaleString('ko-KR');
  }

  function updateResults(stats: ReturnType<typeof analyzeText>) {
    if (charWithSpace) charWithSpace.textContent = formatNumber(stats.totalChars);
    if (charWithoutSpace) charWithoutSpace.textContent = formatNumber(stats.charsNoSpace);
    if (wordCount) wordCount.textContent = formatNumber(stats.totalWords);
    if (koreanCount) koreanCount.textContent = formatNumber(stats.totalKorean) + '자';
    if (englishCount) englishCount.textContent = formatNumber(stats.totalEnglish) + '자';
    if (numberCount) numberCount.textContent = formatNumber(stats.totalNumbers) + '개';
    if (spaceCount) spaceCount.textContent = formatNumber(stats.totalSpaces) + '개';
    if (lineCount) lineCount.textContent = formatNumber(stats.totalLines);
  }

  function handleTextInput() {
    const text = textInput?.value || '';
    const stats = analyzeText(text);
    updateResults(stats);
  }

  textInput?.addEventListener('input', handleTextInput);
  clearBtn?.addEventListener('click', () => {
    if (textInput) {
      textInput.value = '';
      handleTextInput();
      textInput.focus();
    }
  });

  copyBtn?.addEventListener('click', async () => {
    const text = textInput?.value || '';
    if (!text) {
      alert('복사할 텍스트가 없습니다');
      return;
    }
    try {
      await navigator.clipboard.writeText(text);
      alert('텍스트가 복사되었습니다');
    } catch (err) {
      alert('복사에 실패했습니다');
    }
  });

  handleTextInput();
</script>
