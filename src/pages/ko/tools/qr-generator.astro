---
import Layout from '../../../layouts/Layout.astro';
import { getTool } from '../../../utils/tools';

const lang = 'ko';
const tool = getTool('qr-generator', lang);

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": tool?.title,
  "description": tool?.description,
  "applicationCategory": "UtilityApplication",
  "operatingSystem": "All",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "provider": {
    "@type": "Organization",
    "name": "JudySylph",
    "url": "https://judysylph.com"
  }
};
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description} jsonLd={jsonLd}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
    </div>

    <!-- Tool Area -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <!-- Input -->
      <div class="mb-6">
        <label for="qr-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          텍스트 또는 URL 입력
        </label>
        <textarea
          id="qr-input"
          rows="3"
          placeholder="QR코드로 변환할 텍스트나 URL을 입력하세요..."
          class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-y"
        ></textarea>
      </div>

      <!-- Options -->
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div>
          <label for="qr-size" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            크기
          </label>
          <select
            id="qr-size"
            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500"
          >
            <option value="128">128 x 128</option>
            <option value="256" selected>256 x 256</option>
            <option value="512">512 x 512</option>
          </select>
        </div>
        <div>
          <label for="qr-color" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            색상
          </label>
          <input
            type="color"
            id="qr-color"
            value="#000000"
            class="w-full h-12 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 cursor-pointer"
          />
        </div>
      </div>

      <!-- Generate Button -->
      <button
        id="generate-btn"
        type="button"
        class="w-full px-6 py-3 bg-primary-600 text-white font-medium rounded-xl hover:bg-primary-700 transition-colors mb-6"
      >
        QR코드 생성
      </button>

      <!-- QR Code Result -->
      <div id="qr-result" class="hidden">
        <div class="flex flex-col items-center gap-4 p-6 bg-gray-50 dark:bg-gray-700 rounded-xl">
          <canvas id="qr-canvas" class="bg-white p-4 rounded-lg"></canvas>
          <button
            id="download-btn"
            type="button"
            class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
          >
            이미지 다운로드
          </button>
        </div>
      </div>
    </div>

    <!-- Info Section -->
    <div class="mt-8 space-y-4">
      <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-5">
        <h2 class="font-bold text-blue-800 dark:text-blue-200 mb-3">QR코드란?</h2>
        <ul class="text-sm text-blue-700 dark:text-blue-300 space-y-2">
          <li>• <strong>QR (Quick Response)</strong>: 빠른 응답을 위해 설계된 2차원 바코드입니다.</li>
          <li>• 1994년 일본 덴소웨이브에서 개발, 현재 전 세계적으로 사용됩니다.</li>
          <li>• 최대 7,089자의 숫자 또는 4,296자의 영문/숫자를 저장할 수 있습니다.</li>
          <li>• 30%까지 손상되어도 복구가 가능한 오류 정정 기능이 있습니다.</li>
        </ul>
      </div>

      <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-5">
        <h2 class="font-bold text-green-800 dark:text-green-200 mb-3">QR코드 활용 분야</h2>
        <div class="grid grid-cols-2 gap-4 text-sm text-green-700 dark:text-green-300">
          <div>
            <p>• <strong>웹사이트 연결</strong>: URL 공유</p>
            <p>• <strong>결제</strong>: 카카오페이, 네이버페이</p>
            <p>• <strong>명함</strong>: 연락처 정보 공유</p>
            <p>• <strong>WiFi</strong>: 비밀번호 없이 연결</p>
          </div>
          <div>
            <p>• <strong>출입 인증</strong>: 건물, 행사장</p>
            <p>• <strong>제품 정보</strong>: 상세 스펙 확인</p>
            <p>• <strong>메뉴판</strong>: 식당 비대면 주문</p>
            <p>• <strong>마케팅</strong>: 프로모션, 쿠폰</p>
          </div>
        </div>
      </div>

      <div class="bg-purple-50 dark:bg-purple-900/20 rounded-xl p-5">
        <h2 class="font-bold text-purple-800 dark:text-purple-200 mb-3">좋은 QR코드 만들기 팁</h2>
        <ul class="text-sm text-purple-700 dark:text-purple-300 space-y-1">
          <li>• <strong>URL 단축</strong>: 짧은 URL을 사용하면 QR코드가 더 단순해집니다.</li>
          <li>• <strong>충분한 크기</strong>: 최소 2x2cm 이상으로 인쇄하세요.</li>
          <li>• <strong>대비 유지</strong>: 어두운 코드 + 밝은 배경이 인식률이 높습니다.</li>
          <li>• <strong>여백 확보</strong>: QR코드 주변에 여백을 두세요.</li>
          <li>• <strong>테스트 필수</strong>: 인쇄 전 다양한 기기로 스캔 테스트하세요.</li>
        </ul>
      </div>
    </div>

    <!-- Back Link -->
    <div class="mt-8 text-center">
      <a href="/ko/tools" class="text-primary-600 dark:text-primary-400 hover:underline">
        ← 도구 목록으로 돌아가기
      </a>
    </div>
  </div>
</Layout>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script>
  const qrInput = document.getElementById('qr-input') as HTMLTextAreaElement;
  const qrSize = document.getElementById('qr-size') as HTMLSelectElement;
  const qrColor = document.getElementById('qr-color') as HTMLInputElement;
  const generateBtn = document.getElementById('generate-btn');
  const qrResult = document.getElementById('qr-result');
  const qrCanvas = document.getElementById('qr-canvas') as HTMLCanvasElement;
  const downloadBtn = document.getElementById('download-btn');

  generateBtn?.addEventListener('click', () => {
    const text = qrInput?.value.trim();
    if (!text) {
      alert('텍스트를 입력해주세요');
      return;
    }

    const size = parseInt(qrSize?.value || '256');
    const color = qrColor?.value || '#000000';

    // @ts-ignore
    QRCode.toCanvas(qrCanvas, text, {
      width: size,
      margin: 2,
      color: {
        dark: color,
        light: '#ffffff'
      }
    }, (error: any) => {
      if (error) {
        console.error(error);
        alert('QR코드 생성에 실패했습니다');
        return;
      }
      qrResult?.classList.remove('hidden');
    });
  });

  downloadBtn?.addEventListener('click', () => {
    const link = document.createElement('a');
    link.download = 'qrcode.png';
    link.href = qrCanvas?.toDataURL('image/png') || '';
    link.click();
  });
</script>
