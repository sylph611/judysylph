---
import Layout from '../../../layouts/Layout.astro';
import { getTool } from '../../../utils/tools';

const lang = 'ko';
const tool = getTool('loan-refinance', lang);
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <form id="calc-form" class="space-y-6">
        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4 mb-4">
          <h3 class="font-bold text-blue-800 dark:text-blue-200 mb-3">í˜„ì¬ ëŒ€ì¶œ ì •ë³´</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ëŒ€ì¶œ ì”ì•¡</label>
              <input type="text" id="currentBalance" placeholder="10,000" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
              <p class="text-xs text-gray-500 mt-1">ë§Œì›</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">í˜„ì¬ ê¸ˆë¦¬</label>
              <input type="number" id="currentRate" placeholder="5.5" step="0.1" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
              <p class="text-xs text-gray-500 mt-1">ì—° %</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ë‚¨ì€ ê¸°ê°„</label>
              <input type="number" id="remainingMonths" placeholder="240" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
              <p class="text-xs text-gray-500 mt-1">ê°œì›”</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì¤‘ë„ìƒí™˜ ìˆ˜ìˆ˜ë£Œ</label>
              <input type="number" id="prepaymentFee" placeholder="1.0" step="0.1" value="1.0" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
              <p class="text-xs text-gray-500 mt-1">%</p>
            </div>
          </div>
        </div>

        <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-4">
          <h3 class="font-bold text-green-800 dark:text-green-200 mb-3">ìƒˆ ëŒ€ì¶œ ì¡°ê±´</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ìƒˆ ëŒ€ì¶œ ê¸ˆë¦¬</label>
              <input type="number" id="newRate" placeholder="4.0" step="0.1" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
              <p class="text-xs text-gray-500 mt-1">ì—° %</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ìƒˆ ëŒ€ì¶œ ê¸°ê°„</label>
              <input type="number" id="newMonths" placeholder="240" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
              <p class="text-xs text-gray-500 mt-1">ê°œì›”</p>
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ê°ˆì•„íƒ€ê¸° ë¹„ìš© (ë“±ê¸°ë¹„, ì¸ì§€ì„¸ ë“±)</label>
              <input type="text" id="refinanceCost" placeholder="100" value="100" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
              <p class="text-xs text-gray-500 mt-1">ë§Œì›</p>
            </div>
          </div>
        </div>

        <button type="submit" class="w-full px-6 py-3 bg-primary-600 text-white rounded-xl font-medium hover:bg-primary-700">ê°ˆì•„íƒ€ê¸° ë¶„ì„í•˜ê¸°</button>
      </form>

      <div id="result-area" class="mt-8 hidden">
        <div id="result-header" class="rounded-2xl p-6 text-white text-center mb-6">
          <div id="verdict-emoji" class="text-5xl mb-2"></div>
          <div id="verdict" class="text-2xl font-bold mb-2"></div>
          <div id="verdict-desc" class="text-lg opacity-90"></div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
          <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4">
            <h4 class="font-bold text-blue-800 dark:text-blue-200 mb-3 text-center">í˜„ì¬ ëŒ€ì¶œ ìœ ì§€</h4>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ì›” ìƒí™˜ê¸ˆ</span><span id="c-monthly" class="font-medium">-</span></div>
              <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ì´ ì´ì</span><span id="c-interest" class="font-medium">-</span></div>
              <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ì´ ìƒí™˜ì•¡</span><span id="c-total" class="font-medium">-</span></div>
            </div>
          </div>
          <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-4">
            <h4 class="font-bold text-green-800 dark:text-green-200 mb-3 text-center">ëŒ€ì¶œ ê°ˆì•„íƒ€ê¸°</h4>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ì›” ìƒí™˜ê¸ˆ</span><span id="n-monthly" class="font-medium">-</span></div>
              <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ì´ ì´ì</span><span id="n-interest" class="font-medium">-</span></div>
              <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ì´ ìƒí™˜ì•¡</span><span id="n-total" class="font-medium">-</span></div>
            </div>
          </div>
        </div>

        <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-xl p-5 mb-6">
          <h3 class="font-bold text-gray-900 dark:text-white mb-4">ğŸ“Š ìƒì„¸ ë¹„êµ</h3>
          <div class="space-y-3">
            <div class="flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <span class="text-gray-600 dark:text-gray-400">ì›” ìƒí™˜ê¸ˆ ì°¨ì´</span>
              <span id="diff-monthly" class="font-bold"></span>
            </div>
            <div class="flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <span class="text-gray-600 dark:text-gray-400">ì´ ì´ì ì ˆê°</span>
              <span id="diff-interest" class="font-bold"></span>
            </div>
            <div class="flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <span class="text-gray-600 dark:text-gray-400">ê°ˆì•„íƒ€ê¸° ë¹„ìš©</span>
              <span id="total-cost" class="font-bold text-red-500"></span>
            </div>
            <div class="flex justify-between items-center p-2 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
              <span class="text-primary-700 dark:text-primary-300 font-medium">ìˆœ ì ˆê°ì•¡</span>
              <span id="net-saving" class="font-bold text-xl"></span>
            </div>
            <div class="flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <span class="text-gray-600 dark:text-gray-400">ì†ìµë¶„ê¸°ì </span>
              <span id="breakeven" class="font-medium"></span>
            </div>
          </div>
        </div>

        <!-- SEO Content -->
        <div id="seo-content" class="mt-8 space-y-6">
          <h2 id="seo-summary" class="text-2xl font-bold text-gray-900 dark:text-white"></h2>
          <div class="prose dark:prose-invert max-w-none">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">ğŸ“Œ ì´ ê²°ê³¼ê°€ ì˜ë¯¸í•˜ëŠ” ê²ƒ</h3>
            <p id="seo-meaning" class="text-gray-700 dark:text-gray-300 leading-relaxed"></p>
          </div>
          <!-- AD_SLOT: middle-content -->
          <div class="prose dark:prose-invert max-w-none">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">ğŸ‘¤ ì´ëŸ° ë¶„ì—ê²Œ ì í•©í•©ë‹ˆë‹¤</h3>
            <p id="seo-suitable" class="text-gray-700 dark:text-gray-300 leading-relaxed"></p>
          </div>
          <div class="prose dark:prose-invert max-w-none">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">âš ï¸ ì£¼ì˜í•´ì•¼ í•  ì </h3>
            <p id="seo-caution" class="text-gray-700 dark:text-gray-300 leading-relaxed"></p>
          </div>
          <!-- AD_SLOT: before-faq -->
          <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">â“ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</h3>
            <div id="faq-content" class="space-y-4"></div>
          </div>
          <div class="bg-primary-50 dark:bg-primary-900/20 rounded-xl p-5">
            <h3 class="text-lg font-semibold text-primary-800 dark:text-primary-200 mb-3">ğŸ”— ê´€ë ¨ ê³„ì‚°ê¸°</h3>
            <div class="flex flex-wrap gap-2">
              <a href="/ko/tools/mortgage-calculator" class="px-4 py-2 bg-white dark:bg-gray-800 rounded-lg text-primary-600 dark:text-primary-400 hover:bg-primary-100 dark:hover:bg-gray-700 transition-colors">ğŸ¦ ì£¼íƒë‹´ë³´ëŒ€ì¶œ ê³„ì‚°ê¸°</a>
              <a href="/ko/tools/mortgage-comparison" class="px-4 py-2 bg-white dark:bg-gray-800 rounded-lg text-primary-600 dark:text-primary-400 hover:bg-primary-100 dark:hover:bg-gray-700 transition-colors">ğŸ“Š ëŒ€ì¶œ ìƒí™˜ ë¹„êµ</a>
              <a href="/ko/tools/jeonse-loan" class="px-4 py-2 bg-white dark:bg-gray-800 rounded-lg text-primary-600 dark:text-primary-400 hover:bg-primary-100 dark:hover:bg-gray-700 transition-colors">ğŸ  ì „ì„¸ëŒ€ì¶œ ê³„ì‚°ê¸°</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="mt-8 text-center"><a href="/ko/tools" class="text-primary-600 dark:text-primary-400 hover:underline">â† ë„êµ¬ ëª©ë¡</a></div>
  </div>
</Layout>

<script>
  const form = document.getElementById('calc-form') as HTMLFormElement;
  const numInputs = ['currentBalance', 'refinanceCost'];

  numInputs.forEach(id => {
    const el = document.getElementById(id) as HTMLInputElement;
    el?.addEventListener('input', e => {
      const v = (e.target as HTMLInputElement).value.replace(/\D/g,'');
      (e.target as HTMLInputElement).value = Number(v).toLocaleString('ko-KR');
    });
  });

  function calcMonthlyPayment(principal: number, annualRate: number, months: number): number {
    if (annualRate === 0) return principal / months;
    const r = annualRate / 100 / 12;
    return principal * r * Math.pow(1+r, months) / (Math.pow(1+r, months) - 1);
  }

  form?.addEventListener('submit', e => {
    e.preventDefault();

    const balance = parseInt((document.getElementById('currentBalance') as HTMLInputElement).value.replace(/,/g,'')) * 10000;
    const currentRate = parseFloat((document.getElementById('currentRate') as HTMLInputElement).value);
    const remainingMonths = parseInt((document.getElementById('remainingMonths') as HTMLInputElement).value);
    const prepaymentFeeRate = parseFloat((document.getElementById('prepaymentFee') as HTMLInputElement).value) / 100;
    const newRate = parseFloat((document.getElementById('newRate') as HTMLInputElement).value);
    const newMonths = parseInt((document.getElementById('newMonths') as HTMLInputElement).value);
    const refinanceCost = parseInt((document.getElementById('refinanceCost') as HTMLInputElement).value.replace(/,/g,'')) * 10000;

    // Current loan
    const currentMonthly = calcMonthlyPayment(balance, currentRate, remainingMonths);
    const currentTotalPayment = currentMonthly * remainingMonths;
    const currentTotalInterest = currentTotalPayment - balance;

    // New loan
    const prepaymentFee = balance * prepaymentFeeRate;
    const newMonthly = calcMonthlyPayment(balance, newRate, newMonths);
    const newTotalPayment = newMonthly * newMonths;
    const newTotalInterest = newTotalPayment - balance;
    const totalRefinanceCost = prepaymentFee + refinanceCost;

    // Comparison
    const monthlyDiff = currentMonthly - newMonthly;
    const interestSaving = currentTotalInterest - newTotalInterest;
    const netSaving = interestSaving - totalRefinanceCost;
    const breakevenMonths = totalRefinanceCost > 0 && monthlyDiff > 0 ? Math.ceil(totalRefinanceCost / monthlyDiff) : 0;

    document.getElementById('result-area')?.classList.remove('hidden');

    // Verdict
    const header = document.getElementById('result-header')!;
    let verdictEmoji, verdict, verdictDesc, headerColor;

    if (netSaving > 5000000) {
      verdictEmoji = 'ğŸ‰';
      verdict = 'ê°ˆì•„íƒ€ê¸° ê°•ë ¥ ì¶”ì²œ!';
      verdictDesc = `${Math.round(netSaving/10000).toLocaleString()}ë§Œì› ì ˆê° ê°€ëŠ¥`;
      headerColor = 'bg-gradient-to-br from-green-500 to-emerald-600';
    } else if (netSaving > 1000000) {
      verdictEmoji = 'âœ…';
      verdict = 'ê°ˆì•„íƒ€ê¸° ìœ ë¦¬';
      verdictDesc = `${Math.round(netSaving/10000).toLocaleString()}ë§Œì› ì ˆê° ì˜ˆìƒ`;
      headerColor = 'bg-gradient-to-br from-blue-500 to-cyan-600';
    } else if (netSaving > 0) {
      verdictEmoji = 'ğŸ¤”';
      verdict = 'ì†Œí­ ìœ ë¦¬í•˜ë‚˜ ê²€í†  í•„ìš”';
      verdictDesc = `ì ˆê°ì•¡ ${Math.round(netSaving/10000).toLocaleString()}ë§Œì› (ë¹„ìš© ê³ ë ¤ ì‹œ)`;
      headerColor = 'bg-gradient-to-br from-yellow-500 to-amber-600';
    } else {
      verdictEmoji = 'âŒ';
      verdict = 'í˜„ì¬ ëŒ€ì¶œ ìœ ì§€ ê¶Œì¥';
      verdictDesc = `ê°ˆì•„íƒ€ë©´ ${Math.round(Math.abs(netSaving)/10000).toLocaleString()}ë§Œì› ì†í•´`;
      headerColor = 'bg-gradient-to-br from-red-500 to-rose-600';
    }

    header.className = `${headerColor} rounded-2xl p-6 text-white text-center mb-6`;
    document.getElementById('verdict-emoji')!.textContent = verdictEmoji;
    document.getElementById('verdict')!.textContent = verdict;
    document.getElementById('verdict-desc')!.textContent = verdictDesc;

    // Current loan details
    document.getElementById('c-monthly')!.textContent = Math.round(currentMonthly).toLocaleString() + 'ì›';
    document.getElementById('c-interest')!.textContent = Math.round(currentTotalInterest/10000).toLocaleString() + 'ë§Œì›';
    document.getElementById('c-total')!.textContent = Math.round(currentTotalPayment/10000).toLocaleString() + 'ë§Œì›';

    // New loan details
    document.getElementById('n-monthly')!.textContent = Math.round(newMonthly).toLocaleString() + 'ì›';
    document.getElementById('n-interest')!.textContent = Math.round(newTotalInterest/10000).toLocaleString() + 'ë§Œì›';
    document.getElementById('n-total')!.textContent = Math.round(newTotalPayment/10000).toLocaleString() + 'ë§Œì›';

    // Comparison
    const monthlyDiffEl = document.getElementById('diff-monthly')!;
    monthlyDiffEl.textContent = (monthlyDiff >= 0 ? '-' : '+') + Math.abs(Math.round(monthlyDiff)).toLocaleString() + 'ì›/ì›”';
    monthlyDiffEl.className = monthlyDiff >= 0 ? 'font-bold text-green-600' : 'font-bold text-red-500';

    const interestDiffEl = document.getElementById('diff-interest')!;
    interestDiffEl.textContent = (interestSaving >= 0 ? '' : '-') + Math.round(Math.abs(interestSaving)/10000).toLocaleString() + 'ë§Œì›';
    interestDiffEl.className = interestSaving >= 0 ? 'font-bold text-green-600' : 'font-bold text-red-500';

    document.getElementById('total-cost')!.textContent = '-' + Math.round(totalRefinanceCost/10000).toLocaleString() + 'ë§Œì›';

    const netSavingEl = document.getElementById('net-saving')!;
    netSavingEl.textContent = (netSaving >= 0 ? '+' : '') + Math.round(netSaving/10000).toLocaleString() + 'ë§Œì›';
    netSavingEl.className = netSaving >= 0 ? 'font-bold text-xl text-green-600' : 'font-bold text-xl text-red-500';

    document.getElementById('breakeven')!.textContent = breakevenMonths > 0 ? `ì•½ ${breakevenMonths}ê°œì›”` : 'í•´ë‹¹ ì—†ìŒ';

    // SEO Content
    generateSeoContent(balance, currentRate, newRate, remainingMonths, newMonths, netSaving, monthlyDiff, breakevenMonths, totalRefinanceCost);
  });

  function generateSeoContent(balance: number, currentRate: number, newRate: number, remainingMonths: number, newMonths: number, netSaving: number, monthlyDiff: number, breakevenMonths: number, totalCost: number) {
    const balanceMan = Math.round(balance / 10000);
    const rateDiff = currentRate - newRate;
    const isWorthIt = netSaving > 0;

    // Summary
    let summaryText;
    if (netSaving > 5000000) {
      summaryText = `ëŒ€ì¶œ ${balanceMan.toLocaleString()}ë§Œì› ê¸°ì¤€, ê¸ˆë¦¬ ${rateDiff.toFixed(1)}%p ì¸í•˜ë¡œ ${Math.round(netSaving/10000).toLocaleString()}ë§Œì› ì ˆê°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤`;
    } else if (netSaving > 0) {
      summaryText = `ê¸ˆë¦¬ ${rateDiff.toFixed(1)}%p ì°¨ì´ë¡œ ê°ˆì•„íƒ€ê¸° ì‹œ ${Math.round(netSaving/10000).toLocaleString()}ë§Œì›ì˜ ì†Œí­ ì ˆê°ì´ ì˜ˆìƒë©ë‹ˆë‹¤`;
    } else {
      summaryText = `í˜„ì¬ ì¡°ê±´ì—ì„œëŠ” ê°ˆì•„íƒ€ê¸°ë³´ë‹¤ ê¸°ì¡´ ëŒ€ì¶œ ìœ ì§€ê°€ ${Math.round(Math.abs(netSaving)/10000).toLocaleString()}ë§Œì› ìœ ë¦¬í•©ë‹ˆë‹¤`;
    }
    document.getElementById('seo-summary')!.textContent = `ğŸ“‹ ê²°ê³¼ ìš”ì•½: ${summaryText}`;

    // Meaning
    const meaningText = `ëŒ€ì¶œ ì”ì•¡ ${balanceMan.toLocaleString()}ë§Œì›ì„ ê¸°ì¤€ìœ¼ë¡œ í˜„ì¬ ê¸ˆë¦¬ ${currentRate}%ì—ì„œ ${newRate}%ë¡œ ` +
      `${rateDiff.toFixed(1)}%p ${rateDiff > 0 ? 'ë‚®ì€' : 'ë†’ì€'} ê¸ˆë¦¬ë¡œ ê°ˆì•„íƒˆ ê²½ìš°ë¥¼ ë¶„ì„í–ˆìŠµë‹ˆë‹¤. ` +
      `ì›” ìƒí™˜ê¸ˆì€ ${Math.abs(Math.round(monthlyDiff)).toLocaleString()}ì› ${monthlyDiff > 0 ? 'ê°ì†Œ' : 'ì¦ê°€'}í•˜ë©°, ` +
      `ëŒ€ì¶œ ê¸°ê°„ ${newMonths}ê°œì›” ë™ì•ˆì˜ ì´ ì´ì ì ˆê°ì•¡ì—ì„œ ì¤‘ë„ìƒí™˜ìˆ˜ìˆ˜ë£Œì™€ ê°ˆì•„íƒ€ê¸° ë¹„ìš© ` +
      `${Math.round(totalCost/10000).toLocaleString()}ë§Œì›ì„ ì œì™¸í•œ ìˆœ ì ˆê°ì•¡ì€ ${Math.round(netSaving/10000).toLocaleString()}ë§Œì›ì…ë‹ˆë‹¤. ` +
      (breakevenMonths > 0 ? `ì†ìµë¶„ê¸°ì ì€ ì•½ ${breakevenMonths}ê°œì›”ë¡œ, ì´ ê¸°ê°„ ì´í›„ë¶€í„° ì‹¤ì œ ì´ë“ì´ ë°œìƒí•©ë‹ˆë‹¤.` : '');
    document.getElementById('seo-meaning')!.textContent = meaningText;

    // Suitable for
    let suitableText;
    if (isWorthIt && rateDiff >= 1) {
      suitableText = `ê¸ˆë¦¬ ì¸í•˜í­ì´ 1%p ì´ìƒìœ¼ë¡œ í° ë¶„, ëŒ€ì¶œ ì”ì—¬ ê¸°ê°„ì´ 10ë…„ ì´ìƒ ë‚¨ì€ ë¶„, ` +
        `ì¤‘ë„ìƒí™˜ìˆ˜ìˆ˜ë£Œ ë©´ì œ ê¸°ê°„ì´ ì§€ë‚œ ë¶„, ì›” ìƒí™˜ ë¶€ë‹´ì„ ì¤„ì´ê³  ì‹¶ì€ ë¶„, ` +
        `ì‹ ìš©ë“±ê¸‰ì´ ê°œì„ ë˜ì–´ ë” ì¢‹ì€ ì¡°ê±´ì„ ë°›ì„ ìˆ˜ ìˆëŠ” ë¶„ì—ê²Œ ê°ˆì•„íƒ€ê¸°ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.`;
    } else if (isWorthIt) {
      suitableText = `ì†Œí­ì´ì§€ë§Œ ì ˆê°ì´ ê°€ëŠ¥í•œ ìƒí™©ì…ë‹ˆë‹¤. ëŒ€ì¶œ ì”ì•¡ì´ í¬ê³  ì”ì—¬ ê¸°ê°„ì´ ê¸´ ê²½ìš°, ` +
        `íƒ€í–‰ ëŒ€í™˜ ì‹œ ì¶”ê°€ ìš°ëŒ€ê¸ˆë¦¬ë¥¼ ë°›ì„ ìˆ˜ ìˆëŠ” ê²½ìš°, ê³ ì •ê¸ˆë¦¬ì—ì„œ ë³€ë™ê¸ˆë¦¬ë¡œ ì „í™˜í•˜ë ¤ëŠ” ê²½ìš°ì— ê³ ë ¤í•´ë³¼ ë§Œí•©ë‹ˆë‹¤.`;
    } else {
      suitableText = `í˜„ì¬ ì¡°ê±´ì—ì„œëŠ” ê°ˆì•„íƒ€ê¸°ê°€ ë¶ˆë¦¬í•©ë‹ˆë‹¤. ëŒ€ì¶œ ì”ì—¬ ê¸°ê°„ì´ 3ë…„ ë¯¸ë§Œì¸ ë¶„, ` +
        `ì¤‘ë„ìƒí™˜ìˆ˜ìˆ˜ë£Œê°€ ì•„ì§ ë†’ì€ ë¶„, ê¸ˆë¦¬ ì°¨ì´ê°€ 0.5%p ë¯¸ë§Œì¸ ë¶„ì€ ê¸°ì¡´ ëŒ€ì¶œì„ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.`;
    }
    document.getElementById('seo-suitable')!.textContent = suitableText;

    // Caution
    let cautionText = `ëŒ€ì¶œ ê°ˆì•„íƒ€ê¸° ì‹œ ëª‡ ê°€ì§€ ì£¼ì˜ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ì²«ì§¸, ì¤‘ë„ìƒí™˜ìˆ˜ìˆ˜ë£ŒëŠ” ëŒ€ì¶œ ì‹¤í–‰ í›„ 3ë…„ê°„ ë¶€ê³¼ë˜ë©°, ` +
      `ê¸°ê°„ì— ë”°ë¼ 1.5%~0.5%ê¹Œì§€ ì°¨ë“± ì ìš©ë©ë‹ˆë‹¤. ë‘˜ì§¸, ê·¼ì €ë‹¹ ì„¤ì •ë¹„, ì¸ì§€ì„¸, ëŒ€ì¶œ ì·¨ê¸‰ìˆ˜ìˆ˜ë£Œ ë“± ë¶€ëŒ€ë¹„ìš©ì´ ` +
      `100~200ë§Œì› ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì…‹ì§¸, ê°ˆì•„íƒ€ê¸° í›„ ê¸ˆë¦¬ ìƒìŠ¹ ê°€ëŠ¥ì„±ë„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤. ` +
      (isWorthIt ? `í˜„ì¬ ë¶„ì„ ê²°ê³¼ ì†ìµë¶„ê¸°ì ì´ ${breakevenMonths}ê°œì›”ì´ë¯€ë¡œ, ìµœì†Œ ì´ ê¸°ê°„ ì´ìƒ ìœ ì§€í•  ê³„íšì´ì–´ì•¼ í•©ë‹ˆë‹¤.` :
        `í˜„ì¬ ì¡°ê±´ì—ì„œëŠ” ê°ˆì•„íƒ€ê¸° ëŒ€ì‹  ì—¬ìœ ìê¸ˆìœ¼ë¡œ ì›ê¸ˆì„ ì¼ë¶€ ìƒí™˜í•˜ëŠ” ê²ƒì´ ë” íš¨ê³¼ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
    document.getElementById('seo-caution')!.textContent = cautionText;

    // FAQ
    const faqs = [
      {
        q: 'ëŒ€ì¶œ ê°ˆì•„íƒ€ê¸°ëŠ” ì–¸ì œ í•˜ëŠ” ê²ƒì´ ì¢‹ì€ê°€ìš”?',
        a: `ì¼ë°˜ì ìœ¼ë¡œ ê¸ˆë¦¬ ì°¨ì´ê°€ 1%p ì´ìƒì´ê³ , ëŒ€ì¶œ ì”ì—¬ ê¸°ê°„ì´ 10ë…„ ì´ìƒ ë‚¨ì•˜ì„ ë•Œ íš¨ê³¼ì ì…ë‹ˆë‹¤. ì¤‘ë„ìƒí™˜ìˆ˜ìˆ˜ë£Œ ë©´ì œ ì‹œì (ë³´í†µ 3ë…„) ì´í›„ê°€ ìµœì ì…ë‹ˆë‹¤. í˜„ì¬ ê¸ˆë¦¬ ${currentRate}%ì—ì„œ ${newRate}%ë¡œ ê°ˆì•„íƒ€ë©´ ${rateDiff.toFixed(1)}%p ì°¨ì´ê°€ ë‚©ë‹ˆë‹¤.`
      },
      {
        q: 'ê°ˆì•„íƒ€ê¸° ë¹„ìš©ì—ëŠ” ë¬´ì—‡ì´ í¬í•¨ë˜ë‚˜ìš”?',
        a: `ì£¼ìš” ë¹„ìš©ìœ¼ë¡œëŠ” ì¤‘ë„ìƒí™˜ìˆ˜ìˆ˜ë£Œ(ì”ì•¡ì˜ 0.5~1.5%), ê·¼ì €ë‹¹ë§ì†Œ ë° ì„¤ì •ë¹„(ì•½ 50~100ë§Œì›), ì¸ì§€ì„¸(1~5ë§Œì›), ëŒ€ì¶œ ì·¨ê¸‰ìˆ˜ìˆ˜ë£Œ(0~0.5%) ë“±ì´ ìˆìŠµë‹ˆë‹¤. ë³¸ ê³„ì‚°ì—ì„œëŠ” ì´ ${Math.round(totalCost/10000).toLocaleString()}ë§Œì›ìœ¼ë¡œ ì‚°ì •í–ˆìŠµë‹ˆë‹¤.`
      },
      {
        q: 'ê³ ì •ê¸ˆë¦¬ì™€ ë³€ë™ê¸ˆë¦¬ ì¤‘ ì–´ë–¤ ê²ƒìœ¼ë¡œ ê°ˆì•„íƒ€ì•¼ í•˜ë‚˜ìš”?',
        a: 'ê¸ˆë¦¬ ìƒìŠ¹ê¸°ì—ëŠ” ê³ ì •ê¸ˆë¦¬, í•˜ë½ê¸°ì—ëŠ” ë³€ë™ê¸ˆë¦¬ê°€ ìœ ë¦¬í•©ë‹ˆë‹¤. 2026ë…„ í˜„ì¬ ê¸ˆë¦¬ ì¸í•˜ ê¸°ì¡°ë¼ë©´ ë³€ë™ê¸ˆë¦¬ë¥¼, ì¶”ê°€ ì¸ìƒì´ ì˜ˆìƒë˜ë©´ ê³ ì •ê¸ˆë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”. í˜¼í•©í˜•(5ë…„ ê³ ì • í›„ ë³€ë™)ë„ ì¢‹ì€ ëŒ€ì•ˆì…ë‹ˆë‹¤.'
      },
      {
        q: 'ëŒ€ì¶œ ê°ˆì•„íƒ€ê¸° ì ˆì°¨ëŠ” ì–´ë–»ê²Œ ë˜ë‚˜ìš”?',
        a: '1) ìƒˆ ëŒ€ì¶œ ì€í–‰ì—ì„œ ëŒ€ì¶œ ìŠ¹ì¸ â†’ 2) ê¸°ì¡´ ì€í–‰ì— ìƒí™˜ ì˜ˆì • í†µë³´ â†’ 3) ìƒí™˜ê¸ˆ ë° ìˆ˜ìˆ˜ë£Œ í™•ì¸ â†’ 4) ìƒˆ ëŒ€ì¶œ ì‹¤í–‰ ë° ê¸°ì¡´ ëŒ€ì¶œ ìƒí™˜ â†’ 5) ê·¼ì €ë‹¹ ë§ì†Œ ë° ìƒˆ ê·¼ì €ë‹¹ ì„¤ì •. ë³´í†µ 2~4ì£¼ ì†Œìš”ë©ë‹ˆë‹¤.'
      }
    ];

    const faqContainer = document.getElementById('faq-content')!;
    faqContainer.innerHTML = faqs.map(faq => `
      <details class="group">
        <summary class="flex justify-between items-center cursor-pointer list-none p-3 bg-white dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600">
          <span class="font-medium text-gray-900 dark:text-white">${faq.q}</span>
          <span class="text-gray-500 group-open:rotate-180 transition-transform">â–¼</span>
        </summary>
        <p class="mt-2 px-3 text-gray-600 dark:text-gray-400 text-sm">${faq.a}</p>
      </details>
    `).join('');

    // JSON-LD
    const faqSchema = {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": faqs.map(faq => ({
        "@type": "Question",
        "name": faq.q,
        "acceptedAnswer": { "@type": "Answer", "text": faq.a }
      }))
    };
    let schemaScript = document.getElementById('faq-schema') as HTMLScriptElement;
    if (!schemaScript) {
      schemaScript = document.createElement('script');
      schemaScript.id = 'faq-schema';
      schemaScript.type = 'application/ld+json';
      document.head.appendChild(schemaScript);
    }
    schemaScript.textContent = JSON.stringify(faqSchema);
  }
</script>
