---
import Layout from '../../../layouts/Layout.astro';
import { getTool } from '../../../utils/tools';

const lang = 'ko';
const tool = getTool('salary-calculator', lang);
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
      <p class="text-sm text-primary-600 dark:text-primary-400 mt-2">2026년 세율 기준</p>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <form id="calc-form" class="space-y-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">국가</label>
          <select id="country" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
            <option value="US">미국 (United States)</option>
            <option value="UK">영국 (United Kingdom)</option>
            <option value="CA">캐나다 (Canada)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">연봉 (해당 국가 통화)</label>
          <input type="text" id="salary" placeholder="100,000" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">신고 상태</label>
          <select id="status" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
            <option value="single">독신 (Single)</option>
            <option value="married">기혼 (Married)</option>
          </select>
        </div>
        <button type="submit" class="w-full px-6 py-3 bg-primary-600 text-white rounded-xl font-medium hover:bg-primary-700">계산하기</button>
      </form>

      <div id="result-area" class="mt-8 hidden">
        <div class="bg-gradient-to-r from-primary-50 to-secondary-50 dark:from-primary-900/20 dark:to-secondary-900/20 rounded-xl p-6">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">계산 결과 <span id="r-currency" class="text-sm font-normal text-gray-500"></span></h3>
          <div class="space-y-3 mb-4">
            <div class="flex justify-between bg-white dark:bg-gray-800 rounded-lg p-3"><span class="text-gray-600 dark:text-gray-400">연봉</span><span id="r-gross" class="font-medium">-</span></div>
            <div class="flex justify-between bg-white dark:bg-gray-800 rounded-lg p-3"><span class="text-gray-600 dark:text-gray-400">연방/국세</span><span id="r-federal" class="font-medium text-red-500">-</span></div>
            <div class="flex justify-between bg-white dark:bg-gray-800 rounded-lg p-3"><span class="text-gray-600 dark:text-gray-400">사회보장세</span><span id="r-social" class="font-medium text-red-500">-</span></div>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center">
              <div class="text-sm text-gray-600 dark:text-gray-400">연 실수령액</div>
              <div id="r-net-year" class="text-xl font-bold text-primary-600 dark:text-primary-400">-</div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center">
              <div class="text-sm text-gray-600 dark:text-gray-400">월 실수령액</div>
              <div id="r-net-month" class="text-xl font-bold text-primary-600 dark:text-primary-400">-</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-6 bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4">
      <h4 class="font-bold text-blue-800 dark:text-blue-200 mb-2">2026년 세율 정보</h4>
      <p class="text-sm text-blue-700 dark:text-blue-300">US: 10~37% / UK: 0~45% / CA: 15~33% (연방)</p>
    </div>
    <div class="mt-8 text-center"><a href="/ko/tools" class="text-primary-600 dark:text-primary-400 hover:underline">← 도구 목록</a></div>
  </div>
</Layout>

<script>
  const form = document.getElementById('calc-form') as HTMLFormElement;
  const salaryInput = document.getElementById('salary') as HTMLInputElement;

  salaryInput?.addEventListener('input', e => {
    const v = (e.target as HTMLInputElement).value.replace(/\D/g,'');
    (e.target as HTMLInputElement).value = Number(v).toLocaleString();
  });

  // 2026 Tax brackets (simplified)
  const taxData: Record<string, { currency: string; symbol: string; brackets: {l:number;r:number}[]; social: number }> = {
    US: { currency: 'USD', symbol: '$', brackets: [{l:11600,r:0.10},{l:47150,r:0.12},{l:100525,r:0.22},{l:191950,r:0.24},{l:243725,r:0.32},{l:609350,r:0.35},{l:Infinity,r:0.37}], social: 0.0765 },
    UK: { currency: 'GBP', symbol: '£', brackets: [{l:12570,r:0},{l:50270,r:0.20},{l:125140,r:0.40},{l:Infinity,r:0.45}], social: 0.12 },
    CA: { currency: 'CAD', symbol: '$', brackets: [{l:55867,r:0.15},{l:111733,r:0.205},{l:173205,r:0.26},{l:246752,r:0.29},{l:Infinity,r:0.33}], social: 0.0595 }
  };

  function calcTax(income: number, brackets: {l:number;r:number}[]): number {
    let tax = 0, prev = 0;
    for (const b of brackets) {
      if (income <= b.l) { tax += (income - prev) * b.r; break; }
      tax += (b.l - prev) * b.r; prev = b.l;
    }
    return Math.round(tax);
  }

  form?.addEventListener('submit', e => {
    e.preventDefault();
    const country = (document.getElementById('country') as HTMLSelectElement).value;
    const salary = parseInt(salaryInput.value.replace(/,/g,''));
    const data = taxData[country];

    const federal = calcTax(salary, data.brackets);
    const social = Math.round(salary * data.social);
    const netYear = salary - federal - social;
    const netMonth = Math.round(netYear / 12);

    document.getElementById('result-area')?.classList.remove('hidden');
    document.getElementById('r-currency')!.textContent = `(${data.currency})`;
    document.getElementById('r-gross')!.textContent = data.symbol + salary.toLocaleString();
    document.getElementById('r-federal')!.textContent = '-' + data.symbol + federal.toLocaleString();
    document.getElementById('r-social')!.textContent = '-' + data.symbol + social.toLocaleString();
    document.getElementById('r-net-year')!.textContent = data.symbol + netYear.toLocaleString();
    document.getElementById('r-net-month')!.textContent = data.symbol + netMonth.toLocaleString();
  });
</script>
