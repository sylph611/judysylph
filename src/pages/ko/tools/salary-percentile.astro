---
import Layout from '../../../layouts/Layout.astro';
import { getTool } from '../../../utils/tools';

const lang = 'ko';
const tool = getTool('salary-percentile', lang);
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
      <p class="text-sm text-primary-600 dark:text-primary-400 mt-2">2026ë…„ í†µê³„ì²­ ìë£Œ ê¸°ì¤€</p>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <form id="calc-form" class="space-y-6">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ë‚˜ì´</label>
            <input type="number" id="age" placeholder="30" min="20" max="65" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ì„±ë³„</label>
            <select id="gender" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
              <option value="all">ì „ì²´</option>
              <option value="male">ë‚¨ì„±</option>
              <option value="female">ì—¬ì„±</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ì—°ë´‰ (ì„¸ì „)</label>
          <input type="text" id="salary" placeholder="5,000" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
          <p class="text-xs text-gray-500 mt-1">ë§Œì› ë‹¨ìœ„ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
        </div>
        <button type="submit" class="w-full px-6 py-3 bg-primary-600 text-white rounded-xl font-medium hover:bg-primary-700">ë‚´ ìˆœìœ„ í™•ì¸í•˜ê¸°</button>
      </form>

      <div id="result-area" class="mt-8 hidden">
        <div id="result-header" class="rounded-2xl p-8 text-white text-center mb-6">
          <div class="text-lg opacity-90 mb-2">ë‹¹ì‹ ì˜ ì—°ë´‰ ìˆœìœ„</div>
          <div id="percentile" class="text-6xl font-bold mb-2">-</div>
          <div id="percentile-desc" class="text-xl opacity-90">-</div>
        </div>

        <div class="grid grid-cols-3 gap-4 mb-6">
          <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4 text-center">
            <div class="text-sm text-gray-600 dark:text-gray-400">ë™ë…„ë°° í‰ê· </div>
            <div id="r-avg" class="text-xl font-bold text-gray-900 dark:text-white">-</div>
          </div>
          <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4 text-center">
            <div class="text-sm text-gray-600 dark:text-gray-400">í‰ê·  ëŒ€ë¹„</div>
            <div id="r-diff" class="text-xl font-bold">-</div>
          </div>
          <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4 text-center">
            <div class="text-sm text-gray-600 dark:text-gray-400">ë‹¹ì‹ ë³´ë‹¤ ì ê²Œ ë²„ëŠ”</div>
            <div id="r-below" class="text-xl font-bold text-primary-600 dark:text-primary-400">-</div>
          </div>
        </div>

        <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-xl p-5 mb-6">
          <h3 class="font-bold text-gray-900 dark:text-white mb-4">ì—°ë´‰ ë¶„í¬ (ë™ë…„ë°° ê¸°ì¤€)</h3>
          <div class="relative h-8 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden mb-4">
            <div id="distribution-bar" class="absolute left-0 top-0 h-full bg-gradient-to-r from-blue-400 to-purple-500 transition-all duration-500"></div>
            <div id="position-marker" class="absolute top-0 w-1 h-full bg-red-500 transition-all duration-500"></div>
          </div>
          <div class="flex justify-between text-xs text-gray-500">
            <span>í•˜ìœ„ 10%</span>
            <span>ì¤‘ìœ„ 50%</span>
            <span>ìƒìœ„ 10%</span>
          </div>
        </div>

        <div id="comparison-box" class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5 mb-6">
          <h3 class="font-bold text-gray-900 dark:text-white mb-3">ğŸ’¼ ë¹„êµ ë¶„ì„</h3>
          <div id="comparisons" class="space-y-2 text-sm"></div>
        </div>

        <div id="advice-box" class="rounded-xl p-5">
          <h3 class="font-bold mb-2" id="advice-title">-</h3>
          <p id="advice-text" class="text-sm"></p>
        </div>
      </div>
    </div>

    <div class="mt-6 bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4">
      <h4 class="font-bold text-blue-800 dark:text-blue-200 mb-2">2026ë…„ ì—°ë ¹ëŒ€ë³„ í‰ê·  ì—°ë´‰</h4>
      <div class="grid grid-cols-2 gap-2 text-sm text-blue-700 dark:text-blue-300">
        <p>â€¢ 20ëŒ€: 3,200ë§Œì›</p>
        <p>â€¢ 30ëŒ€: 4,800ë§Œì›</p>
        <p>â€¢ 40ëŒ€: 5,600ë§Œì›</p>
        <p>â€¢ 50ëŒ€: 5,200ë§Œì›</p>
      </div>
    </div>
    <div class="mt-8 text-center"><a href="/ko/tools" class="text-primary-600 dark:text-primary-400 hover:underline">â† ë„êµ¬ ëª©ë¡</a></div>
  </div>
</Layout>

<script>
  const form = document.getElementById('calc-form') as HTMLFormElement;
  const salaryInput = document.getElementById('salary') as HTMLInputElement;

  salaryInput?.addEventListener('input', e => {
    const v = (e.target as HTMLInputElement).value.replace(/\D/g,'');
    (e.target as HTMLInputElement).value = Number(v).toLocaleString('ko-KR');
  });

  // 2026ë…„ ì—°ë ¹ëŒ€ë³„ ì—°ë´‰ í†µê³„ (ë§Œì›, ëŒ€ëµì  ì¶”ì •ì¹˜)
  const salaryStats: Record<string, Record<string, {avg: number; median: number; p10: number; p25: number; p75: number; p90: number}>> = {
    all: {
      '20': { avg: 3200, median: 3000, p10: 2200, p25: 2600, p75: 3600, p90: 4200 },
      '25': { avg: 3500, median: 3300, p10: 2400, p25: 2900, p75: 4000, p90: 4800 },
      '30': { avg: 4200, median: 3800, p10: 2800, p25: 3200, p75: 4800, p90: 6000 },
      '35': { avg: 5000, median: 4500, p10: 3200, p25: 3800, p75: 5800, p90: 7500 },
      '40': { avg: 5600, median: 5000, p10: 3500, p25: 4200, p75: 6500, p90: 8500 },
      '45': { avg: 5800, median: 5200, p10: 3600, p25: 4400, p75: 6800, p90: 9000 },
      '50': { avg: 5400, median: 4800, p10: 3200, p25: 4000, p75: 6200, p90: 8000 },
      '55': { avg: 4800, median: 4200, p10: 2800, p25: 3500, p75: 5500, p90: 7000 },
      '60': { avg: 4000, median: 3500, p10: 2400, p25: 3000, p75: 4800, p90: 6000 }
    },
    male: {
      '20': { avg: 3400, median: 3200, p10: 2400, p25: 2800, p75: 3800, p90: 4500 },
      '25': { avg: 3800, median: 3600, p10: 2600, p25: 3100, p75: 4300, p90: 5200 },
      '30': { avg: 4800, median: 4300, p10: 3200, p25: 3700, p75: 5500, p90: 7000 },
      '35': { avg: 5800, median: 5200, p10: 3800, p25: 4500, p75: 6800, p90: 9000 },
      '40': { avg: 6500, median: 5800, p10: 4000, p25: 4800, p75: 7500, p90: 10000 },
      '45': { avg: 6800, median: 6000, p10: 4200, p25: 5000, p75: 8000, p90: 11000 },
      '50': { avg: 6200, median: 5500, p10: 3800, p25: 4600, p75: 7200, p90: 9500 },
      '55': { avg: 5500, median: 4800, p10: 3200, p25: 4000, p75: 6500, p90: 8500 },
      '60': { avg: 4500, median: 4000, p10: 2800, p25: 3400, p75: 5500, p90: 7000 }
    },
    female: {
      '20': { avg: 3000, median: 2800, p10: 2000, p25: 2400, p75: 3400, p90: 4000 },
      '25': { avg: 3200, median: 3000, p10: 2200, p25: 2700, p75: 3700, p90: 4400 },
      '30': { avg: 3600, median: 3300, p10: 2400, p25: 2900, p75: 4200, p90: 5200 },
      '35': { avg: 4000, median: 3600, p10: 2600, p25: 3100, p75: 4700, p90: 6000 },
      '40': { avg: 4200, median: 3800, p10: 2700, p25: 3200, p75: 5000, p90: 6500 },
      '45': { avg: 4300, median: 3900, p10: 2800, p25: 3300, p75: 5200, p90: 6800 },
      '50': { avg: 4000, median: 3600, p10: 2600, p25: 3100, p75: 4800, p90: 6200 },
      '55': { avg: 3600, median: 3200, p10: 2400, p25: 2800, p75: 4300, p90: 5500 },
      '60': { avg: 3200, median: 2800, p10: 2000, p25: 2500, p75: 3800, p90: 5000 }
    }
  };

  function getAgeGroup(age: number): string {
    if (age < 25) return '20';
    if (age < 30) return '25';
    if (age < 35) return '30';
    if (age < 40) return '35';
    if (age < 45) return '40';
    if (age < 50) return '45';
    if (age < 55) return '50';
    if (age < 60) return '55';
    return '60';
  }

  function calcPercentile(salary: number, stats: typeof salaryStats['all']['20']): number {
    if (salary <= stats.p10) return Math.round((salary / stats.p10) * 10);
    if (salary <= stats.p25) return 10 + Math.round(((salary - stats.p10) / (stats.p25 - stats.p10)) * 15);
    if (salary <= stats.median) return 25 + Math.round(((salary - stats.p25) / (stats.median - stats.p25)) * 25);
    if (salary <= stats.p75) return 50 + Math.round(((salary - stats.median) / (stats.p75 - stats.median)) * 25);
    if (salary <= stats.p90) return 75 + Math.round(((salary - stats.p75) / (stats.p90 - stats.p75)) * 15);
    return Math.min(99, 90 + Math.round(((salary - stats.p90) / stats.p90) * 10));
  }

  form?.addEventListener('submit', e => {
    e.preventDefault();
    const age = parseInt((document.getElementById('age') as HTMLInputElement).value);
    const gender = (document.getElementById('gender') as HTMLSelectElement).value;
    const salary = parseInt(salaryInput.value.replace(/,/g,'')) || 0;

    const ageGroup = getAgeGroup(age);
    const stats = salaryStats[gender][ageGroup];
    const percentile = calcPercentile(salary, stats);

    document.getElementById('result-area')?.classList.remove('hidden');

    // í—¤ë” ìƒ‰ìƒ
    let headerColor, emoji;
    if (percentile >= 90) { headerColor = 'bg-gradient-to-br from-amber-400 to-orange-500'; emoji = 'ğŸ‘‘'; }
    else if (percentile >= 75) { headerColor = 'bg-gradient-to-br from-purple-500 to-pink-500'; emoji = 'ğŸ‰'; }
    else if (percentile >= 50) { headerColor = 'bg-gradient-to-br from-blue-500 to-cyan-500'; emoji = 'ğŸ’ª'; }
    else if (percentile >= 25) { headerColor = 'bg-gradient-to-br from-green-500 to-teal-500'; emoji = 'ğŸ“ˆ'; }
    else { headerColor = 'bg-gradient-to-br from-gray-500 to-slate-600'; emoji = 'ğŸŒ±'; }

    const header = document.getElementById('result-header')!;
    header.className = `${headerColor} rounded-2xl p-8 text-white text-center mb-6`;

    document.getElementById('percentile')!.textContent = `ìƒìœ„ ${100 - percentile}%`;

    let desc;
    if (percentile >= 90) desc = `${emoji} ìµœìƒìœ„ê¶Œ! ë™ë…„ë°° 100ëª… ì¤‘ ${100 - percentile}ë“±`;
    else if (percentile >= 75) desc = `${emoji} ìƒìœ„ê¶Œ! ë™ë…„ë°° 4ëª… ì¤‘ 1ë“±`;
    else if (percentile >= 50) desc = `${emoji} í‰ê·  ì´ìƒ! ë™ë…„ë°° ì ˆë°˜ ì´ìƒë³´ë‹¤ ë†’ìŒ`;
    else if (percentile >= 25) desc = `${emoji} ì„±ì¥ ì¤‘! ì•„ì§ ê°ˆ ê¸¸ì´ ìˆì–´ìš”`;
    else desc = `${emoji} ì‹œì‘ ë‹¨ê³„! ì•ìœ¼ë¡œ ì„±ì¥í•  ì ì¬ë ¥ì´ ìˆì–´ìš”`;

    document.getElementById('percentile-desc')!.textContent = desc;

    document.getElementById('r-avg')!.textContent = stats.avg.toLocaleString() + 'ë§Œì›';

    const diff = salary - stats.avg;
    const diffEl = document.getElementById('r-diff')!;
    if (diff >= 0) {
      diffEl.textContent = '+' + diff.toLocaleString() + 'ë§Œì›';
      diffEl.className = 'text-xl font-bold text-green-500';
    } else {
      diffEl.textContent = diff.toLocaleString() + 'ë§Œì›';
      diffEl.className = 'text-xl font-bold text-red-500';
    }

    document.getElementById('r-below')!.textContent = percentile + '%';

    // ë¶„í¬ ë°”
    (document.getElementById('distribution-bar') as HTMLElement).style.width = percentile + '%';
    (document.getElementById('position-marker') as HTMLElement).style.left = percentile + '%';

    // ë¹„êµ ë¶„ì„
    const comparisons = document.getElementById('comparisons')!;
    comparisons.innerHTML = `
      <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">í•˜ìœ„ 10% ê¸°ì¤€</span><span class="font-medium">${stats.p10.toLocaleString()}ë§Œì›</span></div>
      <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">í•˜ìœ„ 25% ê¸°ì¤€</span><span class="font-medium">${stats.p25.toLocaleString()}ë§Œì›</span></div>
      <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ì¤‘ìœ„ê°’ (50%)</span><span class="font-medium">${stats.median.toLocaleString()}ë§Œì›</span></div>
      <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ìƒìœ„ 25% ê¸°ì¤€</span><span class="font-medium">${stats.p75.toLocaleString()}ë§Œì›</span></div>
      <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ìƒìœ„ 10% ê¸°ì¤€</span><span class="font-medium">${stats.p90.toLocaleString()}ë§Œì›</span></div>
    `;

    // ì¡°ì–¸
    let adviceTitle, adviceText, adviceBg;
    if (percentile >= 90) {
      adviceTitle = 'ğŸ† ìµœìƒìœ„ê¶Œì…ë‹ˆë‹¤!';
      adviceText = 'ë‹¹ì‹ ì€ ë™ë…„ë°° ì¤‘ ìµœìƒìœ„ ì†Œë“ìì…ë‹ˆë‹¤. ì´ ìœ„ì¹˜ë¥¼ ìœ ì§€í•˜ë©´ì„œ ìì‚° ê´€ë¦¬ì™€ íˆ¬ìì— ì§‘ì¤‘í•´ë³´ì„¸ìš”. ì„¸ê¸ˆ ìµœì í™”ì™€ ì€í‡´ ê³„íšë„ ì¤‘ìš”í•©ë‹ˆë‹¤.';
      adviceBg = 'bg-amber-50 dark:bg-amber-900/20 text-amber-800 dark:text-amber-200';
    } else if (percentile >= 75) {
      adviceTitle = 'ğŸ¯ ìƒìœ„ê¶Œì…ë‹ˆë‹¤!';
      adviceText = 'í‰ê· ì„ í¬ê²Œ ìƒíšŒí•˜ëŠ” ì—°ë´‰ì…ë‹ˆë‹¤. ì €ì¶•ë¥ ì„ ë†’ì´ê³  íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ë‹¤ì–‘í™”í•´ë³´ì„¸ìš”. ì´ì§ì´ë‚˜ ì§ë¬´ ì „í™˜ìœ¼ë¡œ ë” ë†’ì€ ê³³ì„ ë…¸ë ¤ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
      adviceBg = 'bg-purple-50 dark:bg-purple-900/20 text-purple-800 dark:text-purple-200';
    } else if (percentile >= 50) {
      adviceTitle = 'ğŸ’¼ í‰ê·  ì´ìƒì…ë‹ˆë‹¤!';
      adviceText = 'ë™ë…„ë°° í‰ê· ì„ ë„˜ì–´ì„  ì—°ë´‰ì…ë‹ˆë‹¤. ìê²©ì¦ ì·¨ë“, ì´ì§, ë˜ëŠ” ë¶€ì—…ì„ í†µí•´ ë” ë†’ì€ ìˆ˜ì…ì„ ëª©í‘œë¡œ í•´ë³´ì„¸ìš”. ê¾¸ì¤€í•œ ìê¸°ê³„ë°œì´ ì¤‘ìš”í•©ë‹ˆë‹¤.';
      adviceBg = 'bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200';
    } else if (percentile >= 25) {
      adviceTitle = 'ğŸ“ˆ ì„±ì¥ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤!';
      adviceText = 'ì•„ì§ í‰ê· ì— ë„ë‹¬í•˜ì§€ ëª»í–ˆì§€ë§Œ ì¶©ë¶„íˆ ì„±ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì§ë¬´ ì—­ëŸ‰ ê°•í™”, ì´ì§, ë˜ëŠ” ì—…ê³„ ë³€ê²½ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.';
      adviceBg = 'bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200';
    } else {
      adviceTitle = 'ğŸŒ± ì‹œì‘ì ì…ë‹ˆë‹¤!';
      adviceText = 'í˜„ì¬ ì—°ë´‰ì´ ë‚®ë”ë¼ë„ ë‚™ë‹´í•˜ì§€ ë§ˆì„¸ìš”. ê²½ë ¥ ì´ˆê¸°ì´ê±°ë‚˜ ìƒˆë¡œìš´ ë¶„ì•¼ì— ë„ì „í•œ ê²½ìš°ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¥ê¸°ì ì¸ ì»¤ë¦¬ì–´ ê³„íšì„ ì„¸ì›Œë³´ì„¸ìš”.';
      adviceBg = 'bg-gray-50 dark:bg-gray-900/20 text-gray-800 dark:text-gray-200';
    }

    const adviceBox = document.getElementById('advice-box')!;
    adviceBox.className = `rounded-xl p-5 ${adviceBg}`;
    document.getElementById('advice-title')!.textContent = adviceTitle;
    document.getElementById('advice-text')!.textContent = adviceText;
  });
</script>
