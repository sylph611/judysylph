---
import Layout from '../../../layouts/Layout.astro';
import AdBanner from '../../../components/AdBanner.astro';
import ToolSeoContent from '../../../components/ToolSeoContent.astro';
import { getTool, generateToolBreadcrumbSchema, generateToolHowToSchema, calculatorSteps, getToolStepType } from '../../../utils/tools';

const lang = 'ko';
const tool = getTool('korea-salary-calculator', lang);
const siteUrl = 'https://judysylph.com';
const stepType = getToolStepType('korea-salary-calculator');
const steps = calculatorSteps[lang][stepType];

const webAppSchema = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": tool?.title,
  "description": tool?.description,
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "All",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "KRW" }
};

const breadcrumbSchema = tool ? generateToolBreadcrumbSchema(tool, lang, siteUrl) : null;
const howToSchema = tool ? generateToolHowToSchema(tool, lang, siteUrl, steps) : null;
const jsonLd = [webAppSchema, breadcrumbSchema, howToSchema].filter(Boolean);
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description} jsonLd={jsonLd}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
      <p class="text-sm text-primary-600 dark:text-primary-400 mt-2">2026ë…„ ê¸°ì¤€</p>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <form id="calc-form" class="space-y-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ì—°ë´‰ (ì›)</label>
          <input type="text" id="salary" placeholder="50,000,000" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-lg" />
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ë¶€ì–‘ê°€ì¡± ìˆ˜ (ë³¸ì¸ í¬í•¨)</label>
            <select id="dependents" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
              <option value="1">1ëª… (ë³¸ì¸ë§Œ)</option>
              <option value="2">2ëª…</option>
              <option value="3">3ëª…</option>
              <option value="4">4ëª…</option>
              <option value="5">5ëª… ì´ìƒ</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">20ì„¸ ì´í•˜ ìë…€ ìˆ˜</label>
            <select id="children" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
              <option value="0">ì—†ìŒ</option>
              <option value="1">1ëª…</option>
              <option value="2">2ëª…</option>
              <option value="3">3ëª… ì´ìƒ</option>
            </select>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ë¹„ê³¼ì„¸ì•¡ (ì›”, ì‹ëŒ€/êµí†µë¹„ ë“±)</label>
          <input type="text" id="taxFree" placeholder="200,000" value="200,000" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
          <p class="text-xs text-gray-500 mt-1">ì‹ëŒ€ ì›” 20ë§Œì›ê¹Œì§€ ë¹„ê³¼ì„¸</p>
        </div>

        <button type="submit" class="w-full px-6 py-3 bg-primary-600 text-white rounded-xl font-medium hover:bg-primary-700">ê³„ì‚°í•˜ê¸°</button>
      </form>

      <div id="result-area" class="mt-8 hidden">
        <div class="bg-gradient-to-r from-primary-500 to-secondary-500 rounded-2xl p-6 text-white text-center mb-6">
          <div class="text-sm opacity-80 mb-1">ì›” ì‹¤ìˆ˜ë ¹ì•¡</div>
          <div id="r-net-month" class="text-4xl font-bold mb-2">-</div>
          <div class="text-sm opacity-80">ì—° ì‹¤ìˆ˜ë ¹ì•¡: <span id="r-net-year" class="font-medium">-</span></div>
        </div>

        <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5 mb-6">
          <h3 class="font-bold text-gray-900 dark:text-white mb-4">ğŸ“Š ê¸‰ì—¬ ìƒì„¸</h3>
          <div class="space-y-3">
            <div class="flex justify-between items-center p-3 bg-white dark:bg-gray-800 rounded-lg">
              <span class="text-gray-600 dark:text-gray-400">ì›” ê¸‰ì—¬ (ì„¸ì „)</span>
              <span id="r-gross-month" class="font-bold text-lg">-</span>
            </div>
          </div>
        </div>

        <div class="bg-red-50 dark:bg-red-900/20 rounded-xl p-5 mb-6">
          <h3 class="font-bold text-red-800 dark:text-red-200 mb-4">ğŸ’¸ ê³µì œ ë‚´ì—­ (ì›”)</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">êµ­ë¯¼ì—°ê¸ˆ</span><span id="r-pension" class="font-medium text-red-600">-</span></div>
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ê±´ê°•ë³´í—˜</span><span id="r-health" class="font-medium text-red-600">-</span></div>
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ì¥ê¸°ìš”ì–‘ë³´í—˜</span><span id="r-longterm" class="font-medium text-red-600">-</span></div>
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ê³ ìš©ë³´í—˜</span><span id="r-employ" class="font-medium text-red-600">-</span></div>
            <div class="flex justify-between border-t border-red-200 dark:border-red-800 pt-2 mt-2">
              <span class="font-medium text-gray-700 dark:text-gray-300">4ëŒ€ë³´í—˜ ì†Œê³„</span>
              <span id="r-insurance-total" class="font-bold text-red-600">-</span>
            </div>
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ê·¼ë¡œì†Œë“ì„¸</span><span id="r-income-tax" class="font-medium text-red-600">-</span></div>
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ì§€ë°©ì†Œë“ì„¸</span><span id="r-local-tax" class="font-medium text-red-600">-</span></div>
            <div class="flex justify-between border-t border-red-200 dark:border-red-800 pt-2 mt-2">
              <span class="font-medium text-gray-700 dark:text-gray-300">ì„¸ê¸ˆ ì†Œê³„</span>
              <span id="r-tax-total" class="font-bold text-red-600">-</span>
            </div>
            <div class="flex justify-between border-t-2 border-red-300 dark:border-red-700 pt-3 mt-3">
              <span class="font-bold text-gray-900 dark:text-white">ì´ ê³µì œì•¡</span>
              <span id="r-total-deduct" class="font-bold text-xl text-red-600">-</span>
            </div>
          </div>
        </div>

        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-5 mb-6">
          <h3 class="font-bold text-blue-800 dark:text-blue-200 mb-4">ğŸ“ˆ ì—°ê°„ ìš”ì•½</h3>
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center">
              <div class="text-gray-500 dark:text-gray-400">ì—°ë´‰</div>
              <div id="r-gross-year" class="font-bold text-lg">-</div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center">
              <div class="text-gray-500 dark:text-gray-400">ì—°ê°„ ê³µì œ</div>
              <div id="r-deduct-year" class="font-bold text-lg text-red-500">-</div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center">
              <div class="text-gray-500 dark:text-gray-400">ì‹¤íš¨ì„¸ìœ¨</div>
              <div id="r-effective-rate" class="font-bold text-lg">-</div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center">
              <div class="text-gray-500 dark:text-gray-400">ì‹¤ìˆ˜ë ¹ ë¹„ìœ¨</div>
              <div id="r-net-rate" class="font-bold text-lg text-green-600">-</div>
            </div>
          </div>
        </div>

        <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-4 mb-6">
          <h4 class="font-bold text-yellow-800 dark:text-yellow-200 mb-2">âš ï¸ ì°¸ê³ ì‚¬í•­</h4>
          <ul class="text-sm text-yellow-700 dark:text-yellow-300 space-y-1">
            <li>â€¢ ê°„ì´ì„¸ì•¡í‘œ ê¸°ì¤€ ì¶”ì •ì¹˜ì´ë©°, ì‹¤ì œì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
            <li>â€¢ ì—°ë§ì •ì‚° ì‹œ ì¶”ê°€ ê³µì œë¡œ í™˜ê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
            <li>â€¢ í‡´ì§ê¸ˆ, ì„±ê³¼ê¸‰ ë³„ë„ ì‹œ ì‹¤ìˆ˜ë ¹ì•¡ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤</li>
          </ul>
        </div>

        <div class="bg-primary-50 dark:bg-primary-900/20 rounded-xl p-5">
          <h3 class="text-lg font-semibold text-primary-800 dark:text-primary-200 mb-3">ğŸ”— ê´€ë ¨ ê³„ì‚°ê¸°</h3>
          <div class="flex flex-wrap gap-2">
            <a href="/ko/tools/salary-percentile" class="px-4 py-2 bg-white dark:bg-gray-800 rounded-lg text-primary-600 dark:text-primary-400 hover:bg-primary-100 dark:hover:bg-gray-700 transition-colors">ğŸ“Š ì—°ë´‰ ë°±ë¶„ìœ„</a>
            <a href="/ko/tools/apartment-affordability" class="px-4 py-2 bg-white dark:bg-gray-800 rounded-lg text-primary-600 dark:text-primary-400 hover:bg-primary-100 dark:hover:bg-gray-700 transition-colors">ğŸ¢ ë‚´ ì§‘ ë§ˆë ¨ ê³„ì‚°ê¸°</a>
            <a href="/ko/tools/car-affordability" class="px-4 py-2 bg-white dark:bg-gray-800 rounded-lg text-primary-600 dark:text-primary-400 hover:bg-primary-100 dark:hover:bg-gray-700 transition-colors">ğŸš— ì°¨ëŸ‰ êµ¬ë§¤ ì—¬ë ¥</a>
          </div>
        </div>
      </div>
    </div>
    <AdBanner className="mt-8" />

    <!-- SEO Content -->
    <ToolSeoContent
      title={tool?.title || ''}
      description={tool?.description || ''}
      emoji={tool?.emoji || ''}
      category={tool?.category || ''}
      lang={lang}
      slug={tool?.slug || ''}
    />

    <div class="mt-8 text-center"><a href="/ko/tools" class="text-primary-600 dark:text-primary-400 hover:underline">â† ë„êµ¬ ëª©ë¡</a></div>
  </div>
</Layout>

<script>
  const form = document.getElementById('calc-form') as HTMLFormElement;
  const salaryInput = document.getElementById('salary') as HTMLInputElement;
  const taxFreeInput = document.getElementById('taxFree') as HTMLInputElement;

  [salaryInput, taxFreeInput].forEach(el => {
    el?.addEventListener('input', e => {
      const v = (e.target as HTMLInputElement).value.replace(/\D/g,'');
      (e.target as HTMLInputElement).value = Number(v).toLocaleString();
    });
  });

  // 2026ë…„ 4ëŒ€ë³´í—˜ ìš”ìœ¨ (ì˜ˆìƒì¹˜)
  const PENSION_RATE = 0.045; // êµ­ë¯¼ì—°ê¸ˆ 4.5%
  const PENSION_MAX = 637000; // ì›” ìƒí•œì•¡ (ê¸°ì¤€ì†Œë“ì›”ì•¡ ìƒí•œ ì•½ 617ë§Œì› * 4.5%)
  const HEALTH_RATE = 0.0361; // ê±´ê°•ë³´í—˜ 3.61%
  const LONGTERM_RATE = 0.1327; // ì¥ê¸°ìš”ì–‘ë³´í—˜ (ê±´ê°•ë³´í—˜ì˜ 13.27%)
  const EMPLOY_RATE = 0.009; // ê³ ìš©ë³´í—˜ 0.9%

  // ê·¼ë¡œì†Œë“ ê°„ì´ì„¸ì•¡í‘œ (ì›”ê¸‰ì—¬ ê¸°ì¤€, 2026ë…„)
  // ì‹¤ì œë¡œëŠ” ë§¤ìš° ë³µì¡í•˜ë¯€ë¡œ ê°„ì†Œí™”ëœ ì¶”ì • ì‚¬ìš©
  function calcIncomeTax(monthlyTaxable: number, dependents: number, children: number): number {
    // ì—°ê°„ ê³¼ì„¸í‘œì¤€ ì¶”ì •
    const yearlyTaxable = monthlyTaxable * 12;

    // ê·¼ë¡œì†Œë“ê³µì œ (ê°„ì†Œí™”)
    let deduction = 0;
    if (yearlyTaxable <= 5000000) {
      deduction = yearlyTaxable * 0.7;
    } else if (yearlyTaxable <= 15000000) {
      deduction = 3500000 + (yearlyTaxable - 5000000) * 0.4;
    } else if (yearlyTaxable <= 45000000) {
      deduction = 7500000 + (yearlyTaxable - 15000000) * 0.15;
    } else if (yearlyTaxable <= 100000000) {
      deduction = 12000000 + (yearlyTaxable - 45000000) * 0.05;
    } else {
      deduction = 14750000 + (yearlyTaxable - 100000000) * 0.02;
    }

    // ì¸ì ê³µì œ (ë³¸ì¸ 150ë§Œì› + ë¶€ì–‘ê°€ì¡± 1ì¸ë‹¹ 150ë§Œì›)
    const personalDeduction = dependents * 1500000;

    // ê³¼ì„¸í‘œì¤€
    const taxBase = Math.max(0, yearlyTaxable - deduction - personalDeduction);

    // ì†Œë“ì„¸ ê³„ì‚° (2026ë…„ ì„¸ìœ¨)
    let tax = 0;
    if (taxBase <= 14000000) {
      tax = taxBase * 0.06;
    } else if (taxBase <= 50000000) {
      tax = 840000 + (taxBase - 14000000) * 0.15;
    } else if (taxBase <= 88000000) {
      tax = 6240000 + (taxBase - 50000000) * 0.24;
    } else if (taxBase <= 150000000) {
      tax = 15360000 + (taxBase - 88000000) * 0.35;
    } else if (taxBase <= 300000000) {
      tax = 37060000 + (taxBase - 150000000) * 0.38;
    } else if (taxBase <= 500000000) {
      tax = 94060000 + (taxBase - 300000000) * 0.40;
    } else if (taxBase <= 1000000000) {
      tax = 174060000 + (taxBase - 500000000) * 0.42;
    } else {
      tax = 384060000 + (taxBase - 1000000000) * 0.45;
    }

    // ìë…€ì„¸ì•¡ê³µì œ (1ì¸ 15ë§Œì›, 2ì¸ 35ë§Œì›, 3ì¸ì´ìƒ 35ë§Œì› + ì¶”ê°€ 30ë§Œì›)
    let childCredit = 0;
    if (children === 1) childCredit = 150000;
    else if (children === 2) childCredit = 350000;
    else if (children >= 3) childCredit = 350000 + (children - 2) * 300000;

    // ê·¼ë¡œì†Œë“ì„¸ì•¡ê³µì œ (ê°„ì†Œí™”)
    let earnedIncomeCredit = 0;
    if (tax <= 1300000) {
      earnedIncomeCredit = tax * 0.55;
    } else {
      earnedIncomeCredit = 715000 + (tax - 1300000) * 0.30;
    }
    earnedIncomeCredit = Math.min(earnedIncomeCredit, 740000); // í•œë„

    const finalTax = Math.max(0, tax - childCredit - earnedIncomeCredit);
    return Math.round(finalTax / 12); // ì›” ì„¸ì•¡
  }

  function formatWon(amount: number): string {
    return amount.toLocaleString() + 'ì›';
  }

  form?.addEventListener('submit', e => {
    e.preventDefault();

    const yearSalary = parseInt(salaryInput.value.replace(/,/g,''));
    const monthlyTaxFree = parseInt(taxFreeInput.value.replace(/,/g,'')) || 0;
    const dependents = parseInt((document.getElementById('dependents') as HTMLSelectElement).value);
    const children = parseInt((document.getElementById('children') as HTMLSelectElement).value);

    const monthSalary = Math.round(yearSalary / 12);
    const monthlyTaxable = monthSalary - monthlyTaxFree;

    // 4ëŒ€ë³´í—˜ ê³„ì‚° (ê³¼ì„¸ì†Œë“ ê¸°ì¤€)
    const pension = Math.min(Math.round(monthlyTaxable * PENSION_RATE), PENSION_MAX);
    const health = Math.round(monthlyTaxable * HEALTH_RATE);
    const longterm = Math.round(health * LONGTERM_RATE);
    const employ = Math.round(monthlyTaxable * EMPLOY_RATE);
    const insuranceTotal = pension + health + longterm + employ;

    // ì„¸ê¸ˆ ê³„ì‚°
    const incomeTax = calcIncomeTax(monthlyTaxable, dependents, children);
    const localTax = Math.round(incomeTax * 0.1); // ì§€ë°©ì†Œë“ì„¸ 10%
    const taxTotal = incomeTax + localTax;

    // ì´ ê³µì œ ë° ì‹¤ìˆ˜ë ¹ì•¡
    const totalDeduct = insuranceTotal + taxTotal;
    const netMonth = monthSalary - totalDeduct;
    const netYear = netMonth * 12;
    const deductYear = totalDeduct * 12;

    // ê²°ê³¼ í‘œì‹œ
    document.getElementById('result-area')?.classList.remove('hidden');

    document.getElementById('r-net-month')!.textContent = formatWon(netMonth);
    document.getElementById('r-net-year')!.textContent = formatWon(netYear);
    document.getElementById('r-gross-month')!.textContent = formatWon(monthSalary);

    document.getElementById('r-pension')!.textContent = '-' + formatWon(pension);
    document.getElementById('r-health')!.textContent = '-' + formatWon(health);
    document.getElementById('r-longterm')!.textContent = '-' + formatWon(longterm);
    document.getElementById('r-employ')!.textContent = '-' + formatWon(employ);
    document.getElementById('r-insurance-total')!.textContent = '-' + formatWon(insuranceTotal);

    document.getElementById('r-income-tax')!.textContent = '-' + formatWon(incomeTax);
    document.getElementById('r-local-tax')!.textContent = '-' + formatWon(localTax);
    document.getElementById('r-tax-total')!.textContent = '-' + formatWon(taxTotal);
    document.getElementById('r-total-deduct')!.textContent = '-' + formatWon(totalDeduct);

    document.getElementById('r-gross-year')!.textContent = formatWon(yearSalary);
    document.getElementById('r-deduct-year')!.textContent = '-' + formatWon(deductYear);
    document.getElementById('r-effective-rate')!.textContent = (deductYear / yearSalary * 100).toFixed(1) + '%';
    document.getElementById('r-net-rate')!.textContent = (netYear / yearSalary * 100).toFixed(1) + '%';
  });
</script>
