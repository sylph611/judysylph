---
import Layout from '../../../layouts/Layout.astro';
import { getTool, generateToolBreadcrumbSchema, generateToolHowToSchema, calculatorSteps, getToolStepType } from '../../../utils/tools';

const lang = 'ko';
const tool = getTool('password-generator', lang);

const siteUrl = 'https://judysylph.com';
const stepType = getToolStepType('password-generator');
const steps = calculatorSteps['ko'][stepType];

const webAppSchema = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": tool?.title,
  "description": tool?.description,
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "All",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "KRW" }
};

const breadcrumbSchema = tool ? generateToolBreadcrumbSchema(tool, 'ko', siteUrl) : null;
const howToSchema = tool ? generateToolHowToSchema(tool, 'ko', siteUrl, steps) : null;

const jsonLd = [webAppSchema, breadcrumbSchema, howToSchema].filter(Boolean);
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description} jsonLd={jsonLd}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
    </div>

    <!-- Tool Area -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <!-- Generated Password -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          ìƒì„±ëœ ë¹„ë°€ë²ˆí˜¸
        </label>
        <div class="flex gap-2">
          <input
            type="text"
            id="password-output"
            readonly
            class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-lg"
            placeholder="ë¹„ë°€ë²ˆí˜¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤"
          />
          <button
            id="copy-btn"
            type="button"
            class="px-4 py-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 transition-colors"
            title="ë³µì‚¬"
          >
            ğŸ“‹
          </button>
        </div>
      </div>

      <!-- Password Strength -->
      <div class="mb-6">
        <div class="flex justify-between text-sm mb-1">
          <span class="text-gray-600 dark:text-gray-400">ê°•ë„</span>
          <span id="strength-text" class="font-medium">-</span>
        </div>
        <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
          <div id="strength-bar" class="h-full w-0 transition-all duration-300"></div>
        </div>
      </div>

      <!-- Options -->
      <div class="space-y-4 mb-6">
        <!-- Length -->
        <div>
          <label for="password-length" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            ê¸¸ì´: <span id="length-value">16</span>ì
          </label>
          <input
            type="range"
            id="password-length"
            min="8"
            max="64"
            value="16"
            class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer"
          />
        </div>

        <!-- Character Options -->
        <div class="grid grid-cols-2 gap-4">
          <label class="flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer">
            <input type="checkbox" id="include-uppercase" checked class="w-5 h-5 rounded text-primary-600" />
            <span class="text-gray-700 dark:text-gray-300">ëŒ€ë¬¸ì (A-Z)</span>
          </label>
          <label class="flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer">
            <input type="checkbox" id="include-lowercase" checked class="w-5 h-5 rounded text-primary-600" />
            <span class="text-gray-700 dark:text-gray-300">ì†Œë¬¸ì (a-z)</span>
          </label>
          <label class="flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer">
            <input type="checkbox" id="include-numbers" checked class="w-5 h-5 rounded text-primary-600" />
            <span class="text-gray-700 dark:text-gray-300">ìˆ«ì (0-9)</span>
          </label>
          <label class="flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer">
            <input type="checkbox" id="include-symbols" checked class="w-5 h-5 rounded text-primary-600" />
            <span class="text-gray-700 dark:text-gray-300">íŠ¹ìˆ˜ë¬¸ì (!@#$)</span>
          </label>
        </div>
      </div>

      <!-- Generate Button -->
      <button
        id="generate-btn"
        type="button"
        class="w-full px-6 py-3 bg-primary-600 text-white font-medium rounded-xl hover:bg-primary-700 transition-colors"
      >
        ğŸ”„ ìƒˆ ë¹„ë°€ë²ˆí˜¸ ìƒì„±
      </button>
    </div>

    <!-- Back Link -->
    <div class="mt-8 text-center">
      <a href="/ko/tools" class="text-primary-600 dark:text-primary-400 hover:underline">
        â† ë„êµ¬ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
      </a>
    </div>
  </div>
</Layout>

<script>
  const passwordOutput = document.getElementById('password-output') as HTMLInputElement;
  const copyBtn = document.getElementById('copy-btn');
  const generateBtn = document.getElementById('generate-btn');
  const lengthSlider = document.getElementById('password-length') as HTMLInputElement;
  const lengthValue = document.getElementById('length-value');
  const strengthText = document.getElementById('strength-text');
  const strengthBar = document.getElementById('strength-bar');

  const includeUppercase = document.getElementById('include-uppercase') as HTMLInputElement;
  const includeLowercase = document.getElementById('include-lowercase') as HTMLInputElement;
  const includeNumbers = document.getElementById('include-numbers') as HTMLInputElement;
  const includeSymbols = document.getElementById('include-symbols') as HTMLInputElement;

  const UPPERCASE = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  const LOWERCASE = 'abcdefghijklmnopqrstuvwxyz';
  const NUMBERS = '0123456789';
  const SYMBOLS = '!@#$%^&*()_+-=[]{}|;:,.<>?';

  function generatePassword() {
    let chars = '';
    if (includeUppercase?.checked) chars += UPPERCASE;
    if (includeLowercase?.checked) chars += LOWERCASE;
    if (includeNumbers?.checked) chars += NUMBERS;
    if (includeSymbols?.checked) chars += SYMBOLS;

    if (!chars) {
      alert('ìµœì†Œ í•˜ë‚˜ì˜ ë¬¸ì ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
      return;
    }

    const length = parseInt(lengthSlider?.value || '16');
    let password = '';

    const array = new Uint32Array(length);
    crypto.getRandomValues(array);

    for (let i = 0; i < length; i++) {
      password += chars[array[i] % chars.length];
    }

    if (passwordOutput) passwordOutput.value = password;
    updateStrength(password);
  }

  function updateStrength(password: string) {
    let score = 0;
    if (password.length >= 12) score++;
    if (password.length >= 16) score++;
    if (/[A-Z]/.test(password)) score++;
    if (/[a-z]/.test(password)) score++;
    if (/[0-9]/.test(password)) score++;
    if (/[^A-Za-z0-9]/.test(password)) score++;

    const levels = [
      { text: 'ë§¤ìš° ì•½í•¨', color: 'bg-red-500', width: '16%' },
      { text: 'ì•½í•¨', color: 'bg-orange-500', width: '33%' },
      { text: 'ë³´í†µ', color: 'bg-yellow-500', width: '50%' },
      { text: 'ê°•í•¨', color: 'bg-lime-500', width: '66%' },
      { text: 'ë§¤ìš° ê°•í•¨', color: 'bg-green-500', width: '83%' },
      { text: 'ìµœê°•', color: 'bg-emerald-500', width: '100%' },
    ];

    const level = levels[Math.min(score, levels.length - 1)];
    if (strengthText) strengthText.textContent = level.text;
    if (strengthBar) {
      strengthBar.className = `h-full ${level.color} transition-all duration-300`;
      strengthBar.style.width = level.width;
    }
  }

  lengthSlider?.addEventListener('input', () => {
    if (lengthValue) lengthValue.textContent = lengthSlider.value;
  });

  generateBtn?.addEventListener('click', generatePassword);

  copyBtn?.addEventListener('click', async () => {
    const password = passwordOutput?.value;
    if (!password) {
      alert('ë¨¼ì € ë¹„ë°€ë²ˆí˜¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”');
      return;
    }
    try {
      await navigator.clipboard.writeText(password);
      alert('ë¹„ë°€ë²ˆí˜¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
    } catch {
      alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
    }
  });

  // Generate initial password
  generatePassword();
</script>
