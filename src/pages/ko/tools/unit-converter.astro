---
import Layout from '../../../layouts/Layout.astro';
import { getTool } from '../../../utils/tools';

const lang = 'ko';
const tool = getTool('unit-converter', lang);

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": tool?.title,
  "description": tool?.description,
  "applicationCategory": "UtilityApplication",
  "operatingSystem": "All",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "provider": {
    "@type": "Organization",
    "name": "JudySylph",
    "url": "https://judysylph.com"
  }
};
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description} jsonLd={jsonLd}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
    </div>

    <!-- Tool Area -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <!-- Category Tabs -->
      <div class="flex gap-2 mb-6 flex-wrap">
        <button class="tab-btn active px-4 py-2 rounded-lg font-medium transition-colors" data-category="length">길이</button>
        <button class="tab-btn px-4 py-2 rounded-lg font-medium transition-colors" data-category="weight">무게</button>
        <button class="tab-btn px-4 py-2 rounded-lg font-medium transition-colors" data-category="temperature">온도</button>
        <button class="tab-btn px-4 py-2 rounded-lg font-medium transition-colors" data-category="area">면적</button>
      </div>

      <!-- Converter -->
      <div class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">변환할 값</label>
            <input
              type="number"
              id="input-value"
              placeholder="0"
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">단위</label>
            <select
              id="from-unit"
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
            >
            </select>
          </div>
        </div>

        <!-- Result -->
        <div id="results" class="grid grid-cols-2 md:grid-cols-3 gap-4">
        </div>
      </div>
    </div>

    <!-- Back Link -->
    <div class="mt-8 text-center">
      <a href="/ko/tools" class="text-primary-600 dark:text-primary-400 hover:underline">
        ← 도구 목록으로 돌아가기
      </a>
    </div>
  </div>
</Layout>

<style>
  .tab-btn {
    background-color: rgb(243 244 246);
    color: rgb(75 85 99);
  }
  .tab-btn:hover {
    background-color: rgb(229 231 235);
  }
  .tab-btn.active {
    background-color: rgb(14 165 233);
    color: white;
  }
  :global(.dark) .tab-btn {
    background-color: rgb(55 65 81);
    color: rgb(209 213 219);
  }
  :global(.dark) .tab-btn:hover {
    background-color: rgb(75 85 99);
  }
  :global(.dark) .tab-btn.active {
    background-color: rgb(14 165 233);
    color: white;
  }
</style>

<script>
  const units: Record<string, { name: string; toBase: (v: number) => number; fromBase: (v: number) => number }[]> = {
    length: [
      { name: '밀리미터 (mm)', toBase: v => v / 1000, fromBase: v => v * 1000 },
      { name: '센티미터 (cm)', toBase: v => v / 100, fromBase: v => v * 100 },
      { name: '미터 (m)', toBase: v => v, fromBase: v => v },
      { name: '킬로미터 (km)', toBase: v => v * 1000, fromBase: v => v / 1000 },
      { name: '인치 (in)', toBase: v => v * 0.0254, fromBase: v => v / 0.0254 },
      { name: '피트 (ft)', toBase: v => v * 0.3048, fromBase: v => v / 0.3048 },
      { name: '마일 (mi)', toBase: v => v * 1609.344, fromBase: v => v / 1609.344 },
    ],
    weight: [
      { name: '밀리그램 (mg)', toBase: v => v / 1000000, fromBase: v => v * 1000000 },
      { name: '그램 (g)', toBase: v => v / 1000, fromBase: v => v * 1000 },
      { name: '킬로그램 (kg)', toBase: v => v, fromBase: v => v },
      { name: '톤 (t)', toBase: v => v * 1000, fromBase: v => v / 1000 },
      { name: '온스 (oz)', toBase: v => v * 0.0283495, fromBase: v => v / 0.0283495 },
      { name: '파운드 (lb)', toBase: v => v * 0.453592, fromBase: v => v / 0.453592 },
    ],
    temperature: [
      { name: '섭씨 (°C)', toBase: v => v, fromBase: v => v },
      { name: '화씨 (°F)', toBase: v => (v - 32) * 5/9, fromBase: v => v * 9/5 + 32 },
      { name: '켈빈 (K)', toBase: v => v - 273.15, fromBase: v => v + 273.15 },
    ],
    area: [
      { name: '제곱미터 (m²)', toBase: v => v, fromBase: v => v },
      { name: '제곱킬로미터 (km²)', toBase: v => v * 1000000, fromBase: v => v / 1000000 },
      { name: '평', toBase: v => v * 3.305785, fromBase: v => v / 3.305785 },
      { name: '제곱피트 (ft²)', toBase: v => v * 0.092903, fromBase: v => v / 0.092903 },
      { name: '에이커', toBase: v => v * 4046.86, fromBase: v => v / 4046.86 },
    ],
  };

  let currentCategory = 'length';

  const tabBtns = document.querySelectorAll('.tab-btn');
  const fromUnitSelect = document.getElementById('from-unit') as HTMLSelectElement;
  const inputValue = document.getElementById('input-value') as HTMLInputElement;
  const resultsDiv = document.getElementById('results');

  function updateUnits() {
    const categoryUnits = units[currentCategory];
    fromUnitSelect.innerHTML = categoryUnits.map((u, i) =>
      `<option value="${i}">${u.name}</option>`
    ).join('');
    convert();
  }

  function convert() {
    const value = parseFloat(inputValue.value) || 0;
    const fromIndex = parseInt(fromUnitSelect.value);
    const categoryUnits = units[currentCategory];
    const baseValue = categoryUnits[fromIndex].toBase(value);

    if (resultsDiv) {
      resultsDiv.innerHTML = categoryUnits.map((unit, i) => {
        if (i === fromIndex) return '';
        const converted = unit.fromBase(baseValue);
        const displayValue = Math.abs(converted) < 0.01 || Math.abs(converted) > 999999
          ? converted.toExponential(4)
          : converted.toLocaleString('ko-KR', { maximumFractionDigits: 6 });
        return `
          <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4">
            <div class="text-lg font-bold text-primary-600 dark:text-primary-400">${displayValue}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">${unit.name}</div>
          </div>
        `;
      }).join('');
    }
  }

  tabBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      tabBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentCategory = btn.getAttribute('data-category') || 'length';
      updateUnits();
    });
  });

  fromUnitSelect?.addEventListener('change', convert);
  inputValue?.addEventListener('input', convert);

  updateUnits();
</script>
