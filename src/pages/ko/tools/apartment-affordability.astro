---
import Layout from '../../../layouts/Layout.astro';
import { getTool } from '../../../utils/tools';

const lang = 'ko';
const tool = getTool('apartment-affordability', lang);
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
      <p class="text-sm text-primary-600 dark:text-primary-400 mt-2">2026ë…„ ì„œìš¸/ìˆ˜ë„ê¶Œ ì‹œì„¸ ê¸°ì¤€</p>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <form id="calc-form" class="space-y-6">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ì—°ë´‰ (ì„¸ì „)</label>
            <input type="text" id="salary" placeholder="6,000" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
            <p class="text-xs text-gray-500 mt-1">ë§Œì› ë‹¨ìœ„</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">í˜„ì¬ ìì‚°</label>
            <input type="text" id="assets" placeholder="20,000" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
            <p class="text-xs text-gray-500 mt-1">ë§Œì› ë‹¨ìœ„ (ì €ì¶•+ì „ì„¸ê¸ˆ ë“±)</p>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ëŒ€ì¶œ ì˜í–¥</label>
          <select id="loanWilling" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
            <option value="0">ëŒ€ì¶œ ì—†ì´ êµ¬ë§¤</option>
            <option value="40">DSR 40% ì´ë‚´ ëŒ€ì¶œ</option>
            <option value="60" selected>DSR 60% ì´ë‚´ ëŒ€ì¶œ (ì¼ë°˜ì )</option>
            <option value="80">ìµœëŒ€í•œ ëŒ€ì¶œ í™œìš©</option>
          </select>
        </div>
        <button type="submit" class="w-full px-6 py-3 bg-primary-600 text-white rounded-xl font-medium hover:bg-primary-700">ë‚´ ì•„íŒŒíŠ¸ ì•Œì•„ë³´ê¸°</button>
      </form>

      <div id="result-area" class="mt-8 hidden">
        <div id="result-header" class="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-6 text-white text-center mb-6">
          <div class="text-lg opacity-90 mb-2">ë‹¹ì‹ ì´ êµ¬ë§¤ ê°€ëŠ¥í•œ ì•„íŒŒíŠ¸</div>
          <div id="apt-size" class="text-4xl font-bold mb-2">-</div>
          <div id="apt-price" class="text-xl opacity-90">-</div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
          <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4 text-center">
            <div class="text-sm text-gray-600 dark:text-gray-400">ì˜ˆìƒ ëŒ€ì¶œê¸ˆ</div>
            <div id="r-loan" class="text-xl font-bold text-primary-600 dark:text-primary-400">-</div>
          </div>
          <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4 text-center">
            <div class="text-sm text-gray-600 dark:text-gray-400">ì›” ìƒí™˜ê¸ˆ</div>
            <div id="r-monthly" class="text-xl font-bold text-red-500">-</div>
          </div>
        </div>

        <div id="region-analysis" class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-xl p-5 mb-6">
          <h3 class="font-bold text-gray-900 dark:text-white mb-4">êµ¬ë§¤ ê°€ëŠ¥ ì§€ì—­ ë¶„ì„</h3>
          <div id="regions" class="space-y-3"></div>
        </div>

        <div id="advice-box" class="rounded-xl p-5 mb-6">
          <h3 class="font-bold mb-2">ğŸ’¡ ë§ì¶¤ ì¡°ì–¸</h3>
          <p id="advice-text" class="text-sm"></p>
        </div>

        <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5">
          <h3 class="font-bold text-gray-900 dark:text-white mb-3">ğŸ“Š ì¬ì • ìš”ì•½</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ì´ êµ¬ë§¤ ê°€ëŠ¥ì•¡</span><span id="r-total" class="font-medium">-</span></div>
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ìê¸°ìë³¸</span><span id="r-equity" class="font-medium">-</span></div>
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ëŒ€ì¶œ ë¹„ìœ¨ (LTV)</span><span id="r-ltv" class="font-medium">-</span></div>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-6 bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4">
      <h4 class="font-bold text-blue-800 dark:text-blue-200 mb-2">2026ë…„ ì„œìš¸ ì•„íŒŒíŠ¸ ì‹œì„¸ (í‰ë‹¹)</h4>
      <div class="grid grid-cols-2 gap-2 text-sm text-blue-700 dark:text-blue-300">
        <p>â€¢ ê°•ë‚¨/ì„œì´ˆ: 8,000~15,000ë§Œì›</p>
        <p>â€¢ ìš©ì‚°/ì„±ë™: 5,000~8,000ë§Œì›</p>
        <p>â€¢ ë§ˆí¬/ì˜ë“±í¬: 4,000~6,000ë§Œì›</p>
        <p>â€¢ ë…¸ì›/ë„ë´‰: 2,500~3,500ë§Œì›</p>
      </div>
    </div>
    <div class="mt-8 text-center"><a href="/ko/tools" class="text-primary-600 dark:text-primary-400 hover:underline">â† ë„êµ¬ ëª©ë¡</a></div>
  </div>
</Layout>

<script>
  const form = document.getElementById('calc-form') as HTMLFormElement;
  const salaryInput = document.getElementById('salary') as HTMLInputElement;
  const assetsInput = document.getElementById('assets') as HTMLInputElement;

  [salaryInput, assetsInput].forEach(input => {
    input?.addEventListener('input', e => {
      const v = (e.target as HTMLInputElement).value.replace(/\D/g,'');
      (e.target as HTMLInputElement).value = Number(v).toLocaleString('ko-KR');
    });
  });

  // 2026ë…„ ì„œìš¸/ìˆ˜ë„ê¶Œ í‰ë‹¹ ì‹œì„¸ (ë§Œì›)
  const regions = [
    { name: 'ê°•ë‚¨/ì„œì´ˆ/ì†¡íŒŒ', pricePerPyeong: 10000, emoji: 'ğŸ™ï¸', tier: 'S' },
    { name: 'ìš©ì‚°/ì„±ë™/ê´‘ì§„', pricePerPyeong: 6500, emoji: 'ğŸŒ†', tier: 'A' },
    { name: 'ë§ˆí¬/ì˜ë“±í¬/ë™ì‘', pricePerPyeong: 5000, emoji: 'ğŸ¢', tier: 'A' },
    { name: 'ì„œëŒ€ë¬¸/ì€í‰/ì¤‘ë‘', pricePerPyeong: 3500, emoji: 'ğŸ˜ï¸', tier: 'B' },
    { name: 'ë…¸ì›/ë„ë´‰/ê°•ë¶', pricePerPyeong: 3000, emoji: 'ğŸ ', tier: 'B' },
    { name: 'ê²½ê¸° ë¶„ë‹¹/íŒêµ', pricePerPyeong: 5500, emoji: 'ğŸŒ³', tier: 'A' },
    { name: 'ê²½ê¸° ìˆ˜ì›/ìš©ì¸', pricePerPyeong: 2800, emoji: 'ğŸ¡', tier: 'B' },
    { name: 'ì¸ì²œ/ë¶€ì²œ', pricePerPyeong: 2200, emoji: 'ğŸŒŠ', tier: 'C' }
  ];

  form?.addEventListener('submit', e => {
    e.preventDefault();
    const salary = parseInt(salaryInput.value.replace(/,/g,'')) || 0;
    const assets = parseInt(assetsInput.value.replace(/,/g,'')) || 0;
    const dsrRate = parseInt((document.getElementById('loanWilling') as HTMLSelectElement).value) / 100;

    // ëŒ€ì¶œ ê°€ëŠ¥ì•¡ ê³„ì‚° (DSR ê¸°ì¤€, ì—°ì´ìœ¨ 5%, 30ë…„)
    const monthlyPaymentLimit = (salary * 10000 / 12) * dsrRate;
    const rate = 0.05 / 12;
    const months = 360;
    const maxLoan = dsrRate > 0 ? Math.round(monthlyPaymentLimit * (Math.pow(1+rate,months)-1) / (rate * Math.pow(1+rate,months))) : 0;

    const totalBudget = assets * 10000 + maxLoan;
    const totalBudgetMan = Math.round(totalBudget / 10000);

    // êµ¬ë§¤ ê°€ëŠ¥í•œ í‰ìˆ˜ ê³„ì‚° (ì„œìš¸ í‰ê·  í‰ë‹¹ 4500ë§Œì› ê¸°ì¤€)
    const avgPricePerPyeong = 4500;
    const affordablePyeong = Math.round(totalBudgetMan / avgPricePerPyeong);

    let sizeGrade, headerColor;
    if (affordablePyeong < 15) {
      sizeGrade = 'ì†Œí˜• (10~15í‰)';
      headerColor = 'from-gray-500 to-slate-600';
    } else if (affordablePyeong < 25) {
      sizeGrade = 'ì¤‘ì†Œí˜• (15~25í‰)';
      headerColor = 'from-blue-500 to-cyan-600';
    } else if (affordablePyeong < 35) {
      sizeGrade = 'ì¤‘í˜• (25~35í‰)';
      headerColor = 'from-emerald-500 to-teal-600';
    } else if (affordablePyeong < 45) {
      sizeGrade = 'ì¤‘ëŒ€í˜• (35~45í‰)';
      headerColor = 'from-purple-500 to-pink-600';
    } else {
      sizeGrade = 'ëŒ€í˜• (45í‰ ì´ìƒ)';
      headerColor = 'from-amber-500 to-orange-600';
    }

    document.getElementById('result-area')?.classList.remove('hidden');

    const header = document.getElementById('result-header')!;
    header.className = `bg-gradient-to-br ${headerColor} rounded-2xl p-6 text-white text-center mb-6`;

    document.getElementById('apt-size')!.textContent = sizeGrade;
    document.getElementById('apt-price')!.textContent = `ì˜ˆì‚° ì•½ ${totalBudgetMan.toLocaleString()}ë§Œì›`;

    document.getElementById('r-loan')!.textContent = Math.round(maxLoan/10000).toLocaleString() + 'ë§Œì›';
    const monthlyPayment = Math.round(monthlyPaymentLimit);
    document.getElementById('r-monthly')!.textContent = monthlyPayment.toLocaleString() + 'ì›';

    // ì§€ì—­ë³„ ë¶„ì„
    const regionsDiv = document.getElementById('regions')!;
    regionsDiv.innerHTML = regions.map(r => {
      const affordableSize = Math.round(totalBudgetMan / r.pricePerPyeong);
      const status = affordableSize >= 25 ? 'text-green-600' : affordableSize >= 15 ? 'text-yellow-600' : 'text-red-500';
      return `
        <div class="flex items-center justify-between p-2 bg-gray-100 dark:bg-gray-600 rounded-lg">
          <span class="text-gray-700 dark:text-gray-300">${r.emoji} ${r.name}</span>
          <span class="${status} font-medium">${affordableSize}í‰</span>
        </div>
      `;
    }).join('');

    document.getElementById('r-total')!.textContent = totalBudgetMan.toLocaleString() + 'ë§Œì›';
    document.getElementById('r-equity')!.textContent = assets.toLocaleString() + 'ë§Œì›';
    const ltv = Math.round((maxLoan / totalBudget) * 100);
    document.getElementById('r-ltv')!.textContent = ltv + '%';

    // ì¡°ì–¸
    let advice, adviceBg;
    if (totalBudgetMan < 30000) {
      advice = 'í˜„ì¬ ìì‚°ìœ¼ë¡œëŠ” ì„œìš¸ ë‚´ êµ¬ë§¤ê°€ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²½ê¸°ë„ ì™¸ê³½ì´ë‚˜ ì „ì„¸ë¥¼ ê³ ë ¤í•´ë³´ì„¸ìš”. ì²­ì•½ ë‹¹ì²¨ì„ ë…¸ë ¤ë³´ëŠ” ê²ƒë„ ì¢‹ì€ ì „ëµì…ë‹ˆë‹¤.';
      adviceBg = 'bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200';
    } else if (totalBudgetMan < 60000) {
      advice = 'ì„œìš¸ ì™¸ê³½ì´ë‚˜ ê²½ê¸° ì£¼ìš” ì§€ì—­ì—ì„œ ì¤‘ì†Œí˜• ì•„íŒŒíŠ¸ êµ¬ë§¤ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. êµí†µê³¼ í•™êµ°ì„ ê³ ë ¤í•´ ì‹¤ê±°ì£¼ ìœ„ì£¼ë¡œ ì ‘ê·¼í•˜ì„¸ìš”.';
      adviceBg = 'bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200';
    } else if (totalBudgetMan < 100000) {
      advice = 'ì„œìš¸ ì£¼ìš” ì§€ì—­ì—ì„œ ì¤‘í˜• ì•„íŒŒíŠ¸ êµ¬ë§¤ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì‹ ì¶•ê³¼ êµ¬ì¶•ì˜ ê°€ê²© ì°¨ì´ë¥¼ ë¹„êµí•˜ê³ , ì¬ê±´ì¶• ì˜ˆì • ë‹¨ì§€ë„ ëˆˆì—¬ê²¨ë³´ì„¸ìš”.';
      adviceBg = 'bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200';
    } else {
      advice = 'ê°•ë‚¨ê¶Œì„ í¬í•¨í•œ ì„œìš¸ í•µì‹¬ ì§€ì—­ì—ì„œ ì„ íƒì˜ í­ì´ ë„“ìŠµë‹ˆë‹¤. ì¥ê¸°ì ì¸ ê°€ì¹˜ ìƒìŠ¹ì„ ê³ ë ¤í•´ ì…ì§€ë¥¼ ì‹ ì¤‘íˆ ì„ íƒí•˜ì„¸ìš”.';
      adviceBg = 'bg-purple-50 dark:bg-purple-900/20 text-purple-800 dark:text-purple-200';
    }

    const adviceBox = document.getElementById('advice-box')!;
    adviceBox.className = `rounded-xl p-5 mb-6 ${adviceBg}`;
    document.getElementById('advice-text')!.textContent = advice;
  });
</script>
