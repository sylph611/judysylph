---
import Layout from '../../../layouts/Layout.astro';
import { getTool } from '../../../utils/tools';

const lang = 'ko';
const tool = getTool('car-affordability', lang);
---

<Layout title={`${tool?.title} | JudySylph`} description={tool?.description}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">{tool?.emoji}</div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{tool?.title}</h1>
      <p class="text-gray-600 dark:text-gray-400">{tool?.description}</p>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
      <form id="calc-form" class="space-y-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ì—°ë´‰ (ì„¸ì „)</label>
          <input type="text" id="salary" placeholder="5,000ë§Œì›" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
          <p class="text-xs text-gray-500 mt-1">ë§Œì› ë‹¨ìœ„ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">í˜„ì¬ ì €ì¶•ì•¡</label>
          <input type="text" id="savings" placeholder="3,000ë§Œì›" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ì›” ì €ì¶• ê°€ëŠ¥ ê¸ˆì•¡</label>
          <input type="text" id="monthlySave" placeholder="100ë§Œì›" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
        </div>
        <button type="submit" class="w-full px-6 py-3 bg-primary-600 text-white rounded-xl font-medium hover:bg-primary-700">ë‚´ ì°¨ ì•Œì•„ë³´ê¸°</button>
      </form>

      <div id="result-area" class="mt-8 hidden">
        <div class="bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl p-6 text-white text-center mb-6">
          <div class="text-lg opacity-90 mb-2">ë‹¹ì‹ ì´ ì‚´ ìˆ˜ ìˆëŠ” ì°¨</div>
          <div id="car-grade" class="text-4xl font-bold mb-2">-</div>
          <div id="car-price-range" class="text-xl opacity-90">-</div>
        </div>

        <div id="car-recommendation" class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5 mb-6">
          <h3 class="font-bold text-gray-900 dark:text-white mb-3">ì¶”ì²œ ì°¨ëŸ‰</h3>
          <div id="car-models" class="space-y-2"></div>
        </div>

        <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-xl p-5 mb-6">
          <h3 class="font-bold text-gray-900 dark:text-white mb-3">ì¬ì • ë¶„ì„</h3>
          <div class="space-y-3">
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ì ì • ì°¨ëŸ‰ê°€</span><span id="r-proper" class="font-medium">-</span></div>
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ìµœëŒ€ ì°¨ëŸ‰ê°€</span><span id="r-max" class="font-medium">-</span></div>
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ì›” ìœ ì§€ë¹„ ì˜ˆìƒ</span><span id="r-monthly" class="font-medium">-</span></div>
          </div>
        </div>

        <div id="advice-box" class="rounded-xl p-5">
          <h3 class="font-bold mb-2">ğŸ’¡ ì¡°ì–¸</h3>
          <p id="advice-text" class="text-sm"></p>
        </div>
      </div>
    </div>

    <div class="mt-6 bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4">
      <h4 class="font-bold text-blue-800 dark:text-blue-200 mb-2">ì°¨ëŸ‰ êµ¬ë§¤ ê°€ì´ë“œ</h4>
      <ul class="text-sm text-blue-700 dark:text-blue-300 space-y-1">
        <li>â€¢ <strong>ì ì • ì°¨ëŸ‰ê°€</strong>: ì—°ë´‰ì˜ 30~50% ê¶Œì¥</li>
        <li>â€¢ <strong>ìµœëŒ€ ì°¨ëŸ‰ê°€</strong>: ì—°ë´‰ì˜ 100%ë¥¼ ë„˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤</li>
        <li>â€¢ <strong>ì›” ìœ ì§€ë¹„</strong>: ë³´í—˜, ìœ ë¥˜ë¹„, ì •ë¹„ë¹„ ë“± ì›” 50~80ë§Œì› ì˜ˆìƒ</li>
      </ul>
    </div>
    <div class="mt-8 text-center"><a href="/ko/tools" class="text-primary-600 dark:text-primary-400 hover:underline">â† ë„êµ¬ ëª©ë¡</a></div>
  </div>
</Layout>

<script>
  const form = document.getElementById('calc-form') as HTMLFormElement;
  const inputs = ['salary', 'savings', 'monthlySave'].map(id => document.getElementById(id) as HTMLInputElement);

  inputs.forEach(input => {
    input?.addEventListener('input', e => {
      const v = (e.target as HTMLInputElement).value.replace(/\D/g,'');
      (e.target as HTMLInputElement).value = Number(v).toLocaleString('ko-KR');
    });
  });

  const carData = [
    { grade: 'ğŸš™ ì†Œí˜•ì°¨/ê²½ì°¨', min: 0, max: 2500, models: ['ê¸°ì•„ ëª¨ë‹', 'í˜„ëŒ€ ìºìŠ¤í¼', 'ì‰ë³´ë ˆ ìŠ¤íŒŒí¬', 'ê¸°ì•„ ë ˆì´'], color: 'from-green-500 to-teal-500' },
    { grade: 'ğŸš— ì¤€ì¤‘í˜•ì°¨', min: 2500, max: 3500, models: ['í˜„ëŒ€ ì•„ë°˜ë–¼', 'ê¸°ì•„ K3', 'ì‰ë³´ë ˆ í¬ë£¨ì¦ˆ', 'ë¥´ë…¸ SM3'], color: 'from-blue-500 to-cyan-500' },
    { grade: 'ğŸš˜ ì¤‘í˜•ì°¨', min: 3500, max: 5000, models: ['í˜„ëŒ€ ì˜ë‚˜íƒ€', 'ê¸°ì•„ K5', 'ì‰ë³´ë ˆ ë§ë¦¬ë¶€', 'VW íŒŒì‚¬íŠ¸'], color: 'from-indigo-500 to-purple-500' },
    { grade: 'ğŸš SUV/ì¤€ëŒ€í˜•', min: 5000, max: 7000, models: ['í˜„ëŒ€ íˆ¬ì‹¼', 'ê¸°ì•„ ìŠ¤í¬í‹°ì§€', 'í˜„ëŒ€ ê·¸ëœì €', 'ê¸°ì•„ K8'], color: 'from-purple-500 to-pink-500' },
    { grade: 'ğŸï¸ í”„ë¦¬ë¯¸ì—„', min: 7000, max: 10000, models: ['ì œë„¤ì‹œìŠ¤ G70', 'BMW 3ì‹œë¦¬ì¦ˆ', 'ë²¤ì¸  Cí´ë˜ìŠ¤', 'ì•„ìš°ë”” A4'], color: 'from-pink-500 to-rose-500' },
    { grade: 'ğŸ‘‘ ëŸ­ì…”ë¦¬', min: 10000, max: Infinity, models: ['ì œë„¤ì‹œìŠ¤ G80/G90', 'BMW 5/7ì‹œë¦¬ì¦ˆ', 'ë²¤ì¸  E/Sí´ë˜ìŠ¤', 'í¬ë¥´ì‰ íŒŒë‚˜ë©”ë¼'], color: 'from-amber-500 to-orange-500' }
  ];

  const advices = {
    low: { bg: 'bg-yellow-50 dark:bg-yellow-900/20', text: 'text-yellow-800 dark:text-yellow-200', msg: 'í˜„ì¬ ì €ì¶•ì•¡ê³¼ ì†Œë“ ìˆ˜ì¤€ì„ ê³ ë ¤í•  ë•Œ, ì¤‘ê³ ì°¨ë‚˜ ê²½ì°¨ë¥¼ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. ë¬´ë¦¬í•œ í• ë¶€ëŠ” ìƒí™œì— ë¶€ë‹´ì´ ë  ìˆ˜ ìˆì–´ìš”.' },
    mid: { bg: 'bg-green-50 dark:bg-green-900/20', text: 'text-green-800 dark:text-green-200', msg: 'ì ì •í•œ ìˆ˜ì¤€ì˜ ì°¨ëŸ‰ì„ êµ¬ë§¤í•  ìˆ˜ ìˆëŠ” ìƒí™©ì…ë‹ˆë‹¤. 36ê°œì›” ì´ë‚´ í• ë¶€ë¡œ ë¶€ë‹´ ì—†ì´ êµ¬ë§¤ ê°€ëŠ¥í•©ë‹ˆë‹¤.' },
    high: { bg: 'bg-blue-50 dark:bg-blue-900/20', text: 'text-blue-800 dark:text-blue-200', msg: 'ì—¬ìœ ë¡œìš´ ì¬ì • ìƒí™©ì…ë‹ˆë‹¤! ì›í•˜ì‹œëŠ” ì°¨ëŸ‰ì„ í˜„ê¸ˆ ë˜ëŠ” ë‹¨ê¸° í• ë¶€ë¡œ êµ¬ë§¤í•´ë„ ì¢‹ìŠµë‹ˆë‹¤.' },
    veryHigh: { bg: 'bg-purple-50 dark:bg-purple-900/20', text: 'text-purple-800 dark:text-purple-200', msg: 'í”„ë¦¬ë¯¸ì—„/ëŸ­ì…”ë¦¬ ì°¨ëŸ‰ë„ ë¬´ë¦¬ ì—†ì´ êµ¬ë§¤ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì·¨í–¥ì— ë§ëŠ” ìµœê³ ì˜ ì°¨ë¥¼ ì„ íƒí•˜ì„¸ìš”!' }
  };

  form?.addEventListener('submit', e => {
    e.preventDefault();
    const salary = parseInt(inputs[0].value.replace(/,/g,'')) || 0;
    const savings = parseInt(inputs[1].value.replace(/,/g,'')) || 0;
    const monthly = parseInt(inputs[2].value.replace(/,/g,'')) || 0;

    // ì ì • ì°¨ëŸ‰ê°€: ì—°ë´‰ì˜ 50% ë˜ëŠ” ì €ì¶•ì•¡ì˜ 80% ì¤‘ ì‘ì€ ê°’
    const properPrice = Math.min(salary * 0.5, savings * 0.8 + monthly * 12);
    // ìµœëŒ€ ì°¨ëŸ‰ê°€: ì—°ë´‰ì˜ 100% ë˜ëŠ” ì €ì¶•ì•¡ + 2ë…„ ì €ì¶•
    const maxPrice = Math.min(salary, savings + monthly * 24);

    const targetPrice = (properPrice + maxPrice) / 2;
    const car = carData.find(c => targetPrice >= c.min && targetPrice < c.max) || carData[0];

    const gradient = document.querySelector('#result-area > div:first-child') as HTMLElement;
    gradient.className = `bg-gradient-to-br ${car.color} rounded-2xl p-6 text-white text-center mb-6`;

    document.getElementById('result-area')?.classList.remove('hidden');
    document.getElementById('car-grade')!.textContent = car.grade;
    document.getElementById('car-price-range')!.textContent = car.max === Infinity
      ? `${car.min.toLocaleString()}ë§Œì› ì´ìƒ`
      : `${car.min.toLocaleString()} ~ ${car.max.toLocaleString()}ë§Œì›`;

    const modelsDiv = document.getElementById('car-models')!;
    modelsDiv.innerHTML = car.models.map(m => `<div class="flex items-center gap-2 text-gray-700 dark:text-gray-300"><span class="w-2 h-2 bg-primary-500 rounded-full"></span>${m}</div>`).join('');

    document.getElementById('r-proper')!.textContent = properPrice.toLocaleString() + 'ë§Œì›';
    document.getElementById('r-max')!.textContent = maxPrice.toLocaleString() + 'ë§Œì›';

    const monthlyMaintenance = Math.round(targetPrice * 0.015);
    document.getElementById('r-monthly')!.textContent = `ì•½ ${monthlyMaintenance.toLocaleString()}ë§Œì›`;

    let advice;
    if (salary < 4000) advice = advices.low;
    else if (salary < 6000) advice = advices.mid;
    else if (salary < 10000) advice = advices.high;
    else advice = advices.veryHigh;

    const adviceBox = document.getElementById('advice-box')!;
    adviceBox.className = `rounded-xl p-5 ${advice.bg}`;
    document.getElementById('advice-text')!.className = `text-sm ${advice.text}`;
    document.getElementById('advice-text')!.textContent = advice.msg;
  });
</script>
